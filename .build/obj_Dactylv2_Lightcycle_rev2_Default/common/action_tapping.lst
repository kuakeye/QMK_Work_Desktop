   1               		.file	"action_tapping.c"
   2               	__SP_H__ = 0x3e
   3               	__SP_L__ = 0x3d
   4               	__SREG__ = 0x3f
   5               	__tmp_reg__ = 0
   6               	__zero_reg__ = 1
   7               		.text
   8               	.Ltext0:
   9               		.cfi_sections	.debug_frame
  10               		.section	.text.debug_waiting_buffer,"ax",@progbits
  12               	debug_waiting_buffer:
  13               	.LFB12:
  14               		.file 1 "./tmk_core/common/action_tapping.c"
   1:./tmk_core/common/action_tapping.c **** #include <stdint.h>
   2:./tmk_core/common/action_tapping.c **** #include <stdbool.h>
   3:./tmk_core/common/action_tapping.c **** #include "action.h"
   4:./tmk_core/common/action_tapping.c **** #include "action_layer.h"
   5:./tmk_core/common/action_tapping.c **** #include "action_tapping.h"
   6:./tmk_core/common/action_tapping.c **** #include "keycode.h"
   7:./tmk_core/common/action_tapping.c **** #include "timer.h"
   8:./tmk_core/common/action_tapping.c **** 
   9:./tmk_core/common/action_tapping.c **** #ifdef DEBUG_ACTION
  10:./tmk_core/common/action_tapping.c **** #include "debug.h"
  11:./tmk_core/common/action_tapping.c **** #else
  12:./tmk_core/common/action_tapping.c **** #include "nodebug.h"
  13:./tmk_core/common/action_tapping.c **** #endif
  14:./tmk_core/common/action_tapping.c **** 
  15:./tmk_core/common/action_tapping.c **** #ifndef NO_ACTION_TAPPING
  16:./tmk_core/common/action_tapping.c **** 
  17:./tmk_core/common/action_tapping.c **** #define IS_TAPPING()            !IS_NOEVENT(tapping_key.event)
  18:./tmk_core/common/action_tapping.c **** #define IS_TAPPING_PRESSED()    (IS_TAPPING() && tapping_key.event.pressed)
  19:./tmk_core/common/action_tapping.c **** #define IS_TAPPING_RELEASED()   (IS_TAPPING() && !tapping_key.event.pressed)
  20:./tmk_core/common/action_tapping.c **** #define IS_TAPPING_KEY(k)       (IS_TAPPING() && KEYEQ(tapping_key.event.key, (k)))
  21:./tmk_core/common/action_tapping.c **** #define WITHIN_TAPPING_TERM(e)  (TIMER_DIFF_16(e.time, tapping_key.event.time) < TAPPING_TERM)
  22:./tmk_core/common/action_tapping.c **** 
  23:./tmk_core/common/action_tapping.c **** 
  24:./tmk_core/common/action_tapping.c **** static keyrecord_t tapping_key = {};
  25:./tmk_core/common/action_tapping.c **** static keyrecord_t waiting_buffer[WAITING_BUFFER_SIZE] = {};
  26:./tmk_core/common/action_tapping.c **** static uint8_t waiting_buffer_head = 0;
  27:./tmk_core/common/action_tapping.c **** static uint8_t waiting_buffer_tail = 0;
  28:./tmk_core/common/action_tapping.c **** 
  29:./tmk_core/common/action_tapping.c **** static bool process_tapping(keyrecord_t *record);
  30:./tmk_core/common/action_tapping.c **** static bool waiting_buffer_enq(keyrecord_t record);
  31:./tmk_core/common/action_tapping.c **** static void waiting_buffer_clear(void);
  32:./tmk_core/common/action_tapping.c **** static bool waiting_buffer_typed(keyevent_t event);
  33:./tmk_core/common/action_tapping.c **** static bool waiting_buffer_has_anykey_pressed(void);
  34:./tmk_core/common/action_tapping.c **** static void waiting_buffer_scan_tap(void);
  35:./tmk_core/common/action_tapping.c **** static void debug_tapping_key(void);
  36:./tmk_core/common/action_tapping.c **** static void debug_waiting_buffer(void);
  37:./tmk_core/common/action_tapping.c **** 
  38:./tmk_core/common/action_tapping.c **** 
  39:./tmk_core/common/action_tapping.c **** /** \brief Action Tapping Process
  40:./tmk_core/common/action_tapping.c ****  *
  41:./tmk_core/common/action_tapping.c ****  * FIXME: Needs doc
  42:./tmk_core/common/action_tapping.c ****  */
  43:./tmk_core/common/action_tapping.c **** void action_tapping_process(keyrecord_t record)
  44:./tmk_core/common/action_tapping.c **** {
  45:./tmk_core/common/action_tapping.c ****     if (process_tapping(&record)) {
  46:./tmk_core/common/action_tapping.c ****         if (!IS_NOEVENT(record.event)) {
  47:./tmk_core/common/action_tapping.c ****             debug("processed: "); debug_record(record); debug("\n");
  48:./tmk_core/common/action_tapping.c ****         }
  49:./tmk_core/common/action_tapping.c ****     } else {
  50:./tmk_core/common/action_tapping.c ****         if (!waiting_buffer_enq(record)) {
  51:./tmk_core/common/action_tapping.c ****             // clear all in case of overflow.
  52:./tmk_core/common/action_tapping.c ****             debug("OVERFLOW: CLEAR ALL STATES\n");
  53:./tmk_core/common/action_tapping.c ****             clear_keyboard();
  54:./tmk_core/common/action_tapping.c ****             waiting_buffer_clear();
  55:./tmk_core/common/action_tapping.c ****             tapping_key = (keyrecord_t){};
  56:./tmk_core/common/action_tapping.c ****         }
  57:./tmk_core/common/action_tapping.c ****     }
  58:./tmk_core/common/action_tapping.c **** 
  59:./tmk_core/common/action_tapping.c ****     // process waiting_buffer
  60:./tmk_core/common/action_tapping.c ****     if (!IS_NOEVENT(record.event) && waiting_buffer_head != waiting_buffer_tail) {
  61:./tmk_core/common/action_tapping.c ****         debug("---- action_exec: process waiting_buffer -----\n");
  62:./tmk_core/common/action_tapping.c ****     }
  63:./tmk_core/common/action_tapping.c ****     for (; waiting_buffer_tail != waiting_buffer_head; waiting_buffer_tail = (waiting_buffer_tail +
  64:./tmk_core/common/action_tapping.c ****         if (process_tapping(&waiting_buffer[waiting_buffer_tail])) {
  65:./tmk_core/common/action_tapping.c ****             debug("processed: waiting_buffer["); debug_dec(waiting_buffer_tail); debug("] = ");
  66:./tmk_core/common/action_tapping.c ****             debug_record(waiting_buffer[waiting_buffer_tail]); debug("\n\n");
  67:./tmk_core/common/action_tapping.c ****         } else {
  68:./tmk_core/common/action_tapping.c ****             break;
  69:./tmk_core/common/action_tapping.c ****         }
  70:./tmk_core/common/action_tapping.c ****     }
  71:./tmk_core/common/action_tapping.c ****     if (!IS_NOEVENT(record.event)) {
  72:./tmk_core/common/action_tapping.c ****         debug("\n");
  73:./tmk_core/common/action_tapping.c ****     }
  74:./tmk_core/common/action_tapping.c **** }
  75:./tmk_core/common/action_tapping.c **** 
  76:./tmk_core/common/action_tapping.c **** 
  77:./tmk_core/common/action_tapping.c **** /** \brief Tapping
  78:./tmk_core/common/action_tapping.c ****  *
  79:./tmk_core/common/action_tapping.c ****  * Rule: Tap key is typed(pressed and released) within TAPPING_TERM.
  80:./tmk_core/common/action_tapping.c ****  *       (without interfering by typing other key)
  81:./tmk_core/common/action_tapping.c ****  */
  82:./tmk_core/common/action_tapping.c **** /* return true when key event is processed or consumed. */
  83:./tmk_core/common/action_tapping.c **** bool process_tapping(keyrecord_t *keyp)
  84:./tmk_core/common/action_tapping.c **** {
  85:./tmk_core/common/action_tapping.c ****     keyevent_t event = keyp->event;
  86:./tmk_core/common/action_tapping.c **** 
  87:./tmk_core/common/action_tapping.c ****     // if tapping
  88:./tmk_core/common/action_tapping.c ****     if (IS_TAPPING_PRESSED()) {
  89:./tmk_core/common/action_tapping.c ****         if (WITHIN_TAPPING_TERM(event)) {
  90:./tmk_core/common/action_tapping.c ****             if (tapping_key.tap.count == 0) {
  91:./tmk_core/common/action_tapping.c ****                 if (IS_TAPPING_KEY(event.key) && !event.pressed) {
  92:./tmk_core/common/action_tapping.c ****                     // first tap!
  93:./tmk_core/common/action_tapping.c ****                     debug("Tapping: First tap(0->1).\n");
  94:./tmk_core/common/action_tapping.c ****                     tapping_key.tap.count = 1;
  95:./tmk_core/common/action_tapping.c ****                     debug_tapping_key();
  96:./tmk_core/common/action_tapping.c ****                     process_record(&tapping_key);
  97:./tmk_core/common/action_tapping.c **** 
  98:./tmk_core/common/action_tapping.c ****                     // copy tapping state
  99:./tmk_core/common/action_tapping.c ****                     keyp->tap = tapping_key.tap;
 100:./tmk_core/common/action_tapping.c ****                     // enqueue
 101:./tmk_core/common/action_tapping.c ****                     return false;
 102:./tmk_core/common/action_tapping.c ****                 }
 103:./tmk_core/common/action_tapping.c **** #if TAPPING_TERM >= 500 || defined PERMISSIVE_HOLD
 104:./tmk_core/common/action_tapping.c ****                 /* Process a key typed within TAPPING_TERM
 105:./tmk_core/common/action_tapping.c ****                  * This can register the key before settlement of tapping,
 106:./tmk_core/common/action_tapping.c ****                  * useful for long TAPPING_TERM but may prevent fast typing.
 107:./tmk_core/common/action_tapping.c ****                  */
 108:./tmk_core/common/action_tapping.c ****                 else if (IS_RELEASED(event) && waiting_buffer_typed(event)) {
 109:./tmk_core/common/action_tapping.c ****                     debug("Tapping: End. No tap. Interfered by typing key\n");
 110:./tmk_core/common/action_tapping.c ****                     process_record(&tapping_key);
 111:./tmk_core/common/action_tapping.c ****                     tapping_key = (keyrecord_t){};
 112:./tmk_core/common/action_tapping.c ****                     debug_tapping_key();
 113:./tmk_core/common/action_tapping.c ****                     // enqueue
 114:./tmk_core/common/action_tapping.c ****                     return false;
 115:./tmk_core/common/action_tapping.c ****                 }
 116:./tmk_core/common/action_tapping.c **** #endif
 117:./tmk_core/common/action_tapping.c ****                 /* Process release event of a key pressed before tapping starts
 118:./tmk_core/common/action_tapping.c ****                  * Without this unexpected repeating will occur with having fast repeating setting
 119:./tmk_core/common/action_tapping.c ****                  * https://github.com/tmk/tmk_keyboard/issues/60
 120:./tmk_core/common/action_tapping.c ****                  */
 121:./tmk_core/common/action_tapping.c ****                 else if (IS_RELEASED(event) && !waiting_buffer_typed(event)) {
 122:./tmk_core/common/action_tapping.c ****                     // Modifier should be retained till end of this tapping.
 123:./tmk_core/common/action_tapping.c ****                     action_t action = layer_switch_get_action(event.key);
 124:./tmk_core/common/action_tapping.c ****                     switch (action.kind.id) {
 125:./tmk_core/common/action_tapping.c ****                         case ACT_LMODS:
 126:./tmk_core/common/action_tapping.c ****                         case ACT_RMODS:
 127:./tmk_core/common/action_tapping.c ****                             if (action.key.mods && !action.key.code) return false;
 128:./tmk_core/common/action_tapping.c ****                             if (IS_MOD(action.key.code)) return false;
 129:./tmk_core/common/action_tapping.c ****                             break;
 130:./tmk_core/common/action_tapping.c ****                         case ACT_LMODS_TAP:
 131:./tmk_core/common/action_tapping.c ****                         case ACT_RMODS_TAP:
 132:./tmk_core/common/action_tapping.c ****                             if (action.key.mods && keyp->tap.count == 0) return false;
 133:./tmk_core/common/action_tapping.c ****                             if (IS_MOD(action.key.code)) return false;
 134:./tmk_core/common/action_tapping.c ****                             break;
 135:./tmk_core/common/action_tapping.c ****                     }
 136:./tmk_core/common/action_tapping.c ****                     // Release of key should be process immediately.
 137:./tmk_core/common/action_tapping.c ****                     debug("Tapping: release event of a key pressed before tapping\n");
 138:./tmk_core/common/action_tapping.c ****                     process_record(keyp);
 139:./tmk_core/common/action_tapping.c ****                     return true;
 140:./tmk_core/common/action_tapping.c ****                 }
 141:./tmk_core/common/action_tapping.c ****                 else {
 142:./tmk_core/common/action_tapping.c ****                     // set interrupted flag when other key preesed during tapping
 143:./tmk_core/common/action_tapping.c ****                     if (event.pressed) {
 144:./tmk_core/common/action_tapping.c ****                         tapping_key.tap.interrupted = true;
 145:./tmk_core/common/action_tapping.c ****                     }
 146:./tmk_core/common/action_tapping.c ****                     // enqueue
 147:./tmk_core/common/action_tapping.c ****                     return false;
 148:./tmk_core/common/action_tapping.c ****                 }
 149:./tmk_core/common/action_tapping.c ****             }
 150:./tmk_core/common/action_tapping.c ****             // tap_count > 0
 151:./tmk_core/common/action_tapping.c ****             else {
 152:./tmk_core/common/action_tapping.c ****                 if (IS_TAPPING_KEY(event.key) && !event.pressed) {
 153:./tmk_core/common/action_tapping.c ****                     debug("Tapping: Tap release("); debug_dec(tapping_key.tap.count); debug(")\n");
 154:./tmk_core/common/action_tapping.c ****                     keyp->tap = tapping_key.tap;
 155:./tmk_core/common/action_tapping.c ****                     process_record(keyp);
 156:./tmk_core/common/action_tapping.c ****                     tapping_key = *keyp;
 157:./tmk_core/common/action_tapping.c ****                     debug_tapping_key();
 158:./tmk_core/common/action_tapping.c ****                     return true;
 159:./tmk_core/common/action_tapping.c ****                 }
 160:./tmk_core/common/action_tapping.c ****                 else if (is_tap_key(event.key) && event.pressed) {
 161:./tmk_core/common/action_tapping.c ****                     if (tapping_key.tap.count > 1) {
 162:./tmk_core/common/action_tapping.c ****                         debug("Tapping: Start new tap with releasing last tap(>1).\n");
 163:./tmk_core/common/action_tapping.c ****                         // unregister key
 164:./tmk_core/common/action_tapping.c ****                         process_record(&(keyrecord_t){
 165:./tmk_core/common/action_tapping.c ****                                 .tap = tapping_key.tap,
 166:./tmk_core/common/action_tapping.c ****                                 .event.key = tapping_key.event.key,
 167:./tmk_core/common/action_tapping.c ****                                 .event.time = event.time,
 168:./tmk_core/common/action_tapping.c ****                                 .event.pressed = false
 169:./tmk_core/common/action_tapping.c ****                         });
 170:./tmk_core/common/action_tapping.c ****                     } else {
 171:./tmk_core/common/action_tapping.c ****                         debug("Tapping: Start while last tap(1).\n");
 172:./tmk_core/common/action_tapping.c ****                     }
 173:./tmk_core/common/action_tapping.c ****                     tapping_key = *keyp;
 174:./tmk_core/common/action_tapping.c ****                     waiting_buffer_scan_tap();
 175:./tmk_core/common/action_tapping.c ****                     debug_tapping_key();
 176:./tmk_core/common/action_tapping.c ****                     return true;
 177:./tmk_core/common/action_tapping.c ****                 }
 178:./tmk_core/common/action_tapping.c ****                 else {
 179:./tmk_core/common/action_tapping.c ****                     if (!IS_NOEVENT(event)) {
 180:./tmk_core/common/action_tapping.c ****                         debug("Tapping: key event while last tap(>0).\n");
 181:./tmk_core/common/action_tapping.c ****                     }
 182:./tmk_core/common/action_tapping.c ****                     process_record(keyp);
 183:./tmk_core/common/action_tapping.c ****                     return true;
 184:./tmk_core/common/action_tapping.c ****                 }
 185:./tmk_core/common/action_tapping.c ****             }
 186:./tmk_core/common/action_tapping.c ****         }
 187:./tmk_core/common/action_tapping.c ****         // after TAPPING_TERM
 188:./tmk_core/common/action_tapping.c ****         else {
 189:./tmk_core/common/action_tapping.c ****             if (tapping_key.tap.count == 0) {
 190:./tmk_core/common/action_tapping.c ****                 debug("Tapping: End. Timeout. Not tap(0): ");
 191:./tmk_core/common/action_tapping.c ****                 debug_event(event); debug("\n");
 192:./tmk_core/common/action_tapping.c ****                 process_record(&tapping_key);
 193:./tmk_core/common/action_tapping.c ****                 tapping_key = (keyrecord_t){};
 194:./tmk_core/common/action_tapping.c ****                 debug_tapping_key();
 195:./tmk_core/common/action_tapping.c ****                 return false;
 196:./tmk_core/common/action_tapping.c ****             }  else {
 197:./tmk_core/common/action_tapping.c ****                 if (IS_TAPPING_KEY(event.key) && !event.pressed) {
 198:./tmk_core/common/action_tapping.c ****                     debug("Tapping: End. last timeout tap release(>0).");
 199:./tmk_core/common/action_tapping.c ****                     keyp->tap = tapping_key.tap;
 200:./tmk_core/common/action_tapping.c ****                     process_record(keyp);
 201:./tmk_core/common/action_tapping.c ****                     tapping_key = (keyrecord_t){};
 202:./tmk_core/common/action_tapping.c ****                     return true;
 203:./tmk_core/common/action_tapping.c ****                 }
 204:./tmk_core/common/action_tapping.c ****                 else if (is_tap_key(event.key) && event.pressed) {
 205:./tmk_core/common/action_tapping.c ****                     if (tapping_key.tap.count > 1) {
 206:./tmk_core/common/action_tapping.c ****                         debug("Tapping: Start new tap with releasing last timeout tap(>1).\n");
 207:./tmk_core/common/action_tapping.c ****                         // unregister key
 208:./tmk_core/common/action_tapping.c ****                         process_record(&(keyrecord_t){
 209:./tmk_core/common/action_tapping.c ****                                 .tap = tapping_key.tap,
 210:./tmk_core/common/action_tapping.c ****                                 .event.key = tapping_key.event.key,
 211:./tmk_core/common/action_tapping.c ****                                 .event.time = event.time,
 212:./tmk_core/common/action_tapping.c ****                                 .event.pressed = false
 213:./tmk_core/common/action_tapping.c ****                         });
 214:./tmk_core/common/action_tapping.c ****                     } else {
 215:./tmk_core/common/action_tapping.c ****                         debug("Tapping: Start while last timeout tap(1).\n");
 216:./tmk_core/common/action_tapping.c ****                     }
 217:./tmk_core/common/action_tapping.c ****                     tapping_key = *keyp;
 218:./tmk_core/common/action_tapping.c ****                     waiting_buffer_scan_tap();
 219:./tmk_core/common/action_tapping.c ****                     debug_tapping_key();
 220:./tmk_core/common/action_tapping.c ****                     return true;
 221:./tmk_core/common/action_tapping.c ****                 }
 222:./tmk_core/common/action_tapping.c ****                 else {
 223:./tmk_core/common/action_tapping.c ****                     if (!IS_NOEVENT(event)) {
 224:./tmk_core/common/action_tapping.c ****                         debug("Tapping: key event while last timeout tap(>0).\n");
 225:./tmk_core/common/action_tapping.c ****                     }
 226:./tmk_core/common/action_tapping.c ****                     process_record(keyp);
 227:./tmk_core/common/action_tapping.c ****                     return true;
 228:./tmk_core/common/action_tapping.c ****                 }
 229:./tmk_core/common/action_tapping.c ****             }
 230:./tmk_core/common/action_tapping.c ****         }
 231:./tmk_core/common/action_tapping.c ****     } else if (IS_TAPPING_RELEASED()) {
 232:./tmk_core/common/action_tapping.c ****         if (WITHIN_TAPPING_TERM(event)) {
 233:./tmk_core/common/action_tapping.c ****             if (event.pressed) {
 234:./tmk_core/common/action_tapping.c ****                 if (IS_TAPPING_KEY(event.key)) {
 235:./tmk_core/common/action_tapping.c **** #ifndef TAPPING_FORCE_HOLD
 236:./tmk_core/common/action_tapping.c ****                     if (!tapping_key.tap.interrupted && tapping_key.tap.count > 0) {
 237:./tmk_core/common/action_tapping.c ****                         // sequential tap.
 238:./tmk_core/common/action_tapping.c ****                         keyp->tap = tapping_key.tap;
 239:./tmk_core/common/action_tapping.c ****                         if (keyp->tap.count < 15) keyp->tap.count += 1;
 240:./tmk_core/common/action_tapping.c ****                         debug("Tapping: Tap press("); debug_dec(keyp->tap.count); debug(")\n");
 241:./tmk_core/common/action_tapping.c ****                         process_record(keyp);
 242:./tmk_core/common/action_tapping.c ****                         tapping_key = *keyp;
 243:./tmk_core/common/action_tapping.c ****                         debug_tapping_key();
 244:./tmk_core/common/action_tapping.c ****                         return true;
 245:./tmk_core/common/action_tapping.c ****                     }
 246:./tmk_core/common/action_tapping.c **** #endif
 247:./tmk_core/common/action_tapping.c ****                     // FIX: start new tap again
 248:./tmk_core/common/action_tapping.c ****                     tapping_key = *keyp;
 249:./tmk_core/common/action_tapping.c ****                     return true;
 250:./tmk_core/common/action_tapping.c ****                 } else if (is_tap_key(event.key)) {
 251:./tmk_core/common/action_tapping.c ****                     // Sequential tap can be interfered with other tap key.
 252:./tmk_core/common/action_tapping.c ****                     debug("Tapping: Start with interfering other tap.\n");
 253:./tmk_core/common/action_tapping.c ****                     tapping_key = *keyp;
 254:./tmk_core/common/action_tapping.c ****                     waiting_buffer_scan_tap();
 255:./tmk_core/common/action_tapping.c ****                     debug_tapping_key();
 256:./tmk_core/common/action_tapping.c ****                     return true;
 257:./tmk_core/common/action_tapping.c ****                 } else {
 258:./tmk_core/common/action_tapping.c ****                     // should none in buffer
 259:./tmk_core/common/action_tapping.c ****                     // FIX: interrupted when other key is pressed
 260:./tmk_core/common/action_tapping.c ****                     tapping_key.tap.interrupted = true;
 261:./tmk_core/common/action_tapping.c ****                     process_record(keyp);
 262:./tmk_core/common/action_tapping.c ****                     return true;
 263:./tmk_core/common/action_tapping.c ****                 }
 264:./tmk_core/common/action_tapping.c ****             } else {
 265:./tmk_core/common/action_tapping.c ****                 if (!IS_NOEVENT(event)) debug("Tapping: other key just after tap.\n");
 266:./tmk_core/common/action_tapping.c ****                 process_record(keyp);
 267:./tmk_core/common/action_tapping.c ****                 return true;
 268:./tmk_core/common/action_tapping.c ****             }
 269:./tmk_core/common/action_tapping.c ****         } else {
 270:./tmk_core/common/action_tapping.c ****             // FIX: process_action here?
 271:./tmk_core/common/action_tapping.c ****             // timeout. no sequential tap.
 272:./tmk_core/common/action_tapping.c ****             debug("Tapping: End(Timeout after releasing last tap): ");
 273:./tmk_core/common/action_tapping.c ****             debug_event(event); debug("\n");
 274:./tmk_core/common/action_tapping.c ****             tapping_key = (keyrecord_t){};
 275:./tmk_core/common/action_tapping.c ****             debug_tapping_key();
 276:./tmk_core/common/action_tapping.c ****             return false;
 277:./tmk_core/common/action_tapping.c ****         }
 278:./tmk_core/common/action_tapping.c ****     }
 279:./tmk_core/common/action_tapping.c ****     // not tapping state
 280:./tmk_core/common/action_tapping.c ****     else {
 281:./tmk_core/common/action_tapping.c ****         if (event.pressed && is_tap_key(event.key)) {
 282:./tmk_core/common/action_tapping.c ****             debug("Tapping: Start(Press tap key).\n");
 283:./tmk_core/common/action_tapping.c ****             tapping_key = *keyp;
 284:./tmk_core/common/action_tapping.c ****             process_record_tap_hint(&tapping_key);
 285:./tmk_core/common/action_tapping.c ****             waiting_buffer_scan_tap();
 286:./tmk_core/common/action_tapping.c ****             debug_tapping_key();
 287:./tmk_core/common/action_tapping.c ****             return true;
 288:./tmk_core/common/action_tapping.c ****         } else {
 289:./tmk_core/common/action_tapping.c ****             process_record(keyp);
 290:./tmk_core/common/action_tapping.c ****             return true;
 291:./tmk_core/common/action_tapping.c ****         }
 292:./tmk_core/common/action_tapping.c ****     }
 293:./tmk_core/common/action_tapping.c **** }
 294:./tmk_core/common/action_tapping.c **** 
 295:./tmk_core/common/action_tapping.c **** 
 296:./tmk_core/common/action_tapping.c **** /** \brief Waiting buffer enq
 297:./tmk_core/common/action_tapping.c ****  *
 298:./tmk_core/common/action_tapping.c ****  * FIXME: Needs docs
 299:./tmk_core/common/action_tapping.c ****  */
 300:./tmk_core/common/action_tapping.c **** bool waiting_buffer_enq(keyrecord_t record)
 301:./tmk_core/common/action_tapping.c **** {
 302:./tmk_core/common/action_tapping.c ****     if (IS_NOEVENT(record.event)) {
 303:./tmk_core/common/action_tapping.c ****         return true;
 304:./tmk_core/common/action_tapping.c ****     }
 305:./tmk_core/common/action_tapping.c **** 
 306:./tmk_core/common/action_tapping.c ****     if ((waiting_buffer_head + 1) % WAITING_BUFFER_SIZE == waiting_buffer_tail) {
 307:./tmk_core/common/action_tapping.c ****         debug("waiting_buffer_enq: Over flow.\n");
 308:./tmk_core/common/action_tapping.c ****         return false;
 309:./tmk_core/common/action_tapping.c ****     }
 310:./tmk_core/common/action_tapping.c **** 
 311:./tmk_core/common/action_tapping.c ****     waiting_buffer[waiting_buffer_head] = record;
 312:./tmk_core/common/action_tapping.c ****     waiting_buffer_head = (waiting_buffer_head + 1) % WAITING_BUFFER_SIZE;
 313:./tmk_core/common/action_tapping.c **** 
 314:./tmk_core/common/action_tapping.c ****     debug("waiting_buffer_enq: "); debug_waiting_buffer();
 315:./tmk_core/common/action_tapping.c ****     return true;
 316:./tmk_core/common/action_tapping.c **** }
 317:./tmk_core/common/action_tapping.c **** 
 318:./tmk_core/common/action_tapping.c **** /** \brief Waiting buffer clear
 319:./tmk_core/common/action_tapping.c ****  *
 320:./tmk_core/common/action_tapping.c ****  * FIXME: Needs docs
 321:./tmk_core/common/action_tapping.c ****  */
 322:./tmk_core/common/action_tapping.c **** void waiting_buffer_clear(void)
 323:./tmk_core/common/action_tapping.c **** {
 324:./tmk_core/common/action_tapping.c ****     waiting_buffer_head = 0;
 325:./tmk_core/common/action_tapping.c ****     waiting_buffer_tail = 0;
 326:./tmk_core/common/action_tapping.c **** }
 327:./tmk_core/common/action_tapping.c **** 
 328:./tmk_core/common/action_tapping.c **** /** \brief Waiting buffer typed
 329:./tmk_core/common/action_tapping.c ****  *
 330:./tmk_core/common/action_tapping.c ****  * FIXME: Needs docs
 331:./tmk_core/common/action_tapping.c ****  */
 332:./tmk_core/common/action_tapping.c **** bool waiting_buffer_typed(keyevent_t event)
 333:./tmk_core/common/action_tapping.c **** {
 334:./tmk_core/common/action_tapping.c ****     for (uint8_t i = waiting_buffer_tail; i != waiting_buffer_head; i = (i + 1) % WAITING_BUFFER_SI
 335:./tmk_core/common/action_tapping.c ****         if (KEYEQ(event.key, waiting_buffer[i].event.key) && event.pressed !=  waiting_buffer[i].ev
 336:./tmk_core/common/action_tapping.c ****             return true;
 337:./tmk_core/common/action_tapping.c ****         }
 338:./tmk_core/common/action_tapping.c ****     }
 339:./tmk_core/common/action_tapping.c ****     return false;
 340:./tmk_core/common/action_tapping.c **** }
 341:./tmk_core/common/action_tapping.c **** 
 342:./tmk_core/common/action_tapping.c **** /** \brief Waiting buffer has anykey pressed
 343:./tmk_core/common/action_tapping.c ****  *
 344:./tmk_core/common/action_tapping.c ****  * FIXME: Needs docs
 345:./tmk_core/common/action_tapping.c ****  */
 346:./tmk_core/common/action_tapping.c **** __attribute__((unused))
 347:./tmk_core/common/action_tapping.c **** bool waiting_buffer_has_anykey_pressed(void)
 348:./tmk_core/common/action_tapping.c **** {
 349:./tmk_core/common/action_tapping.c ****     for (uint8_t i = waiting_buffer_tail; i != waiting_buffer_head; i = (i + 1) % WAITING_BUFFER_SI
 350:./tmk_core/common/action_tapping.c ****         if (waiting_buffer[i].event.pressed) return true;
 351:./tmk_core/common/action_tapping.c ****     }
 352:./tmk_core/common/action_tapping.c ****     return false;
 353:./tmk_core/common/action_tapping.c **** }
 354:./tmk_core/common/action_tapping.c **** 
 355:./tmk_core/common/action_tapping.c **** /** \brief Scan buffer for tapping
 356:./tmk_core/common/action_tapping.c ****  *
 357:./tmk_core/common/action_tapping.c ****  * FIXME: Needs docs
 358:./tmk_core/common/action_tapping.c ****  */
 359:./tmk_core/common/action_tapping.c **** void waiting_buffer_scan_tap(void)
 360:./tmk_core/common/action_tapping.c **** {
 361:./tmk_core/common/action_tapping.c ****     // tapping already is settled
 362:./tmk_core/common/action_tapping.c ****     if (tapping_key.tap.count > 0) return;
 363:./tmk_core/common/action_tapping.c ****     // invalid state: tapping_key released && tap.count == 0
 364:./tmk_core/common/action_tapping.c ****     if (!tapping_key.event.pressed) return;
 365:./tmk_core/common/action_tapping.c **** 
 366:./tmk_core/common/action_tapping.c ****     for (uint8_t i = waiting_buffer_tail; i != waiting_buffer_head; i = (i + 1) % WAITING_BUFFER_SI
 367:./tmk_core/common/action_tapping.c ****         if (IS_TAPPING_KEY(waiting_buffer[i].event.key) &&
 368:./tmk_core/common/action_tapping.c ****                 !waiting_buffer[i].event.pressed &&
 369:./tmk_core/common/action_tapping.c ****                 WITHIN_TAPPING_TERM(waiting_buffer[i].event)) {
 370:./tmk_core/common/action_tapping.c ****             tapping_key.tap.count = 1;
 371:./tmk_core/common/action_tapping.c ****             waiting_buffer[i].tap.count = 1;
 372:./tmk_core/common/action_tapping.c ****             process_record(&tapping_key);
 373:./tmk_core/common/action_tapping.c **** 
 374:./tmk_core/common/action_tapping.c ****             debug("waiting_buffer_scan_tap: found at ["); debug_dec(i); debug("]\n");
 375:./tmk_core/common/action_tapping.c ****             debug_waiting_buffer();
 376:./tmk_core/common/action_tapping.c ****             return;
 377:./tmk_core/common/action_tapping.c ****         }
 378:./tmk_core/common/action_tapping.c ****     }
 379:./tmk_core/common/action_tapping.c **** }
 380:./tmk_core/common/action_tapping.c **** 
 381:./tmk_core/common/action_tapping.c **** 
 382:./tmk_core/common/action_tapping.c **** /** \brief Tapping key debug print
 383:./tmk_core/common/action_tapping.c ****  *
 384:./tmk_core/common/action_tapping.c ****  * FIXME: Needs docs
 385:./tmk_core/common/action_tapping.c ****  */
 386:./tmk_core/common/action_tapping.c **** static void debug_tapping_key(void)
 387:./tmk_core/common/action_tapping.c **** {
 388:./tmk_core/common/action_tapping.c ****     debug("TAPPING_KEY="); debug_record(tapping_key); debug("\n");
 389:./tmk_core/common/action_tapping.c **** }
 390:./tmk_core/common/action_tapping.c **** 
 391:./tmk_core/common/action_tapping.c **** /** \brief Waiting buffer debug print
 392:./tmk_core/common/action_tapping.c ****  *
 393:./tmk_core/common/action_tapping.c ****  * FIXME: Needs docs
 394:./tmk_core/common/action_tapping.c ****  */
 395:./tmk_core/common/action_tapping.c **** static void debug_waiting_buffer(void)
 396:./tmk_core/common/action_tapping.c **** {
  15               		.loc 1 396 1 view -0
  16               		.cfi_startproc
  17 0000 1F93      		push r17
  18               	.LCFI0:
  19               		.cfi_def_cfa_offset 3
  20               		.cfi_offset 17, -2
  21 0002 CF93      		push r28
  22               	.LCFI1:
  23               		.cfi_def_cfa_offset 4
  24               		.cfi_offset 28, -3
  25 0004 DF93      		push r29
  26               	.LCFI2:
  27               		.cfi_def_cfa_offset 5
  28               		.cfi_offset 29, -4
  29               	/* prologue: function */
  30               	/* frame size = 0 */
  31               	/* stack size = 3 */
  32               	.L__stack_usage = 3
 397:./tmk_core/common/action_tapping.c ****     debug("{ ");
  33               		.loc 1 397 16 view .LVU1
 398:./tmk_core/common/action_tapping.c ****     for (uint8_t i = waiting_buffer_tail; i != waiting_buffer_head; i = (i + 1) % WAITING_BUFFER_SI
  34               		.loc 1 398 5 view .LVU2
  35               	.LBB3:
  36               		.loc 1 398 10 view .LVU3
  37               		.loc 1 398 18 is_stmt 0 view .LVU4
  38 0006 E091 0000 		lds r30,waiting_buffer_tail
  39               	.LVL0:
 399:./tmk_core/common/action_tapping.c ****         debug("["); debug_dec(i); debug("]="); debug_record(waiting_buffer[i]); debug(" ");
  40               		.loc 1 399 48 view .LVU5
  41 000a 16E0      		ldi r17,lo8(6)
  42               	.LVL1:
  43               	.L2:
 398:./tmk_core/common/action_tapping.c ****     for (uint8_t i = waiting_buffer_tail; i != waiting_buffer_head; i = (i + 1) % WAITING_BUFFER_SI
  44               		.loc 1 398 43 is_stmt 1 discriminator 1 view .LVU6
 398:./tmk_core/common/action_tapping.c ****     for (uint8_t i = waiting_buffer_tail; i != waiting_buffer_head; i = (i + 1) % WAITING_BUFFER_SI
  45               		.loc 1 398 5 is_stmt 0 discriminator 1 view .LVU7
  46 000c 8091 0000 		lds r24,waiting_buffer_head
  47 0010 8E13      		cpse r24,r30
  48 0012 00C0      		rjmp .L3
  49               	/* epilogue start */
  50               	.LBE3:
 400:./tmk_core/common/action_tapping.c ****     }
 401:./tmk_core/common/action_tapping.c ****     debug("}\n");
 402:./tmk_core/common/action_tapping.c **** }
  51               		.loc 1 402 1 view .LVU8
  52 0014 DF91      		pop r29
  53 0016 CF91      		pop r28
  54 0018 1F91      		pop r17
  55 001a 0895      		ret
  56               	.L3:
  57               	.LBB4:
 399:./tmk_core/common/action_tapping.c ****         debug("["); debug_dec(i); debug("]="); debug_record(waiting_buffer[i]); debug(" ");
  58               		.loc 1 399 19 is_stmt 1 discriminator 3 view .LVU9
 399:./tmk_core/common/action_tapping.c ****         debug("["); debug_dec(i); debug("]="); debug_record(waiting_buffer[i]); debug(" ");
  59               		.loc 1 399 33 discriminator 3 view .LVU10
 399:./tmk_core/common/action_tapping.c ****         debug("["); debug_dec(i); debug("]="); debug_record(waiting_buffer[i]); debug(" ");
  60               		.loc 1 399 46 discriminator 3 view .LVU11
 399:./tmk_core/common/action_tapping.c ****         debug("["); debug_dec(i); debug("]="); debug_record(waiting_buffer[i]); debug(" ");
  61               		.loc 1 399 48 discriminator 3 view .LVU12
  62 001c CE2F      		mov r28,r30
  63 001e D0E0      		ldi r29,0
  64 0020 1E9F      		mul r17,r30
  65 0022 F001      		movw r30,r0
  66 0024 1124      		clr __zero_reg__
  67               	.LVL2:
 399:./tmk_core/common/action_tapping.c ****         debug("["); debug_dec(i); debug("]="); debug_record(waiting_buffer[i]); debug(" ");
  68               		.loc 1 399 48 is_stmt 0 discriminator 3 view .LVU13
  69 0026 E050      		subi r30,lo8(-(waiting_buffer))
  70 0028 F040      		sbci r31,hi8(-(waiting_buffer))
  71 002a 4081      		ld r20,Z
  72 002c 5181      		ldd r21,Z+1
  73 002e 6281      		ldd r22,Z+2
  74 0030 7381      		ldd r23,Z+3
  75 0032 8481      		ldd r24,Z+4
  76 0034 9581      		ldd r25,Z+5
  77 0036 0E94 0000 		call debug_record
  78               	.LVL3:
 399:./tmk_core/common/action_tapping.c ****         debug("["); debug_dec(i); debug("]="); debug_record(waiting_buffer[i]); debug(" ");
  79               		.loc 1 399 91 is_stmt 1 discriminator 3 view .LVU14
 398:./tmk_core/common/action_tapping.c ****         debug("["); debug_dec(i); debug("]="); debug_record(waiting_buffer[i]); debug(" ");
  80               		.loc 1 398 69 discriminator 3 view .LVU15
 398:./tmk_core/common/action_tapping.c ****         debug("["); debug_dec(i); debug("]="); debug_record(waiting_buffer[i]); debug(" ");
  81               		.loc 1 398 76 is_stmt 0 discriminator 3 view .LVU16
  82 003a FE01      		movw r30,r28
  83 003c 3196      		adiw r30,1
 398:./tmk_core/common/action_tapping.c ****         debug("["); debug_dec(i); debug("]="); debug_record(waiting_buffer[i]); debug(" ");
  84               		.loc 1 398 71 discriminator 3 view .LVU17
  85 003e E770      		andi r30,lo8(7)
  86               	.LVL4:
 398:./tmk_core/common/action_tapping.c ****         debug("["); debug_dec(i); debug("]="); debug_record(waiting_buffer[i]); debug(" ");
  87               		.loc 1 398 71 discriminator 3 view .LVU18
  88 0040 00C0      		rjmp .L2
  89               	.LBE4:
  90               		.cfi_endproc
  91               	.LFE12:
  93               		.section	.text.debug_tapping_key,"ax",@progbits
  95               	debug_tapping_key:
  96               	.LFB11:
 387:./tmk_core/common/action_tapping.c ****     debug("TAPPING_KEY="); debug_record(tapping_key); debug("\n");
  97               		.loc 1 387 1 is_stmt 1 view -0
  98               		.cfi_startproc
  99               	/* prologue: function */
 100               	/* frame size = 0 */
 101               	/* stack size = 0 */
 102               	.L__stack_usage = 0
 388:./tmk_core/common/action_tapping.c **** }
 103               		.loc 1 388 26 view .LVU20
 388:./tmk_core/common/action_tapping.c **** }
 104               		.loc 1 388 28 view .LVU21
 105 0000 4091 0000 		lds r20,tapping_key
 106 0004 5091 0000 		lds r21,tapping_key+1
 107 0008 6091 0000 		lds r22,tapping_key+2
 108 000c 7091 0000 		lds r23,tapping_key+3
 109 0010 8091 0000 		lds r24,tapping_key+4
 110 0014 9091 0000 		lds r25,tapping_key+5
 111 0018 0C94 0000 		jmp debug_record
 112               	.LVL5:
 113               		.cfi_endproc
 114               	.LFE11:
 116               		.section	.text.waiting_buffer_typed.isra.0,"ax",@progbits
 118               	waiting_buffer_typed.isra.0:
 119               	.LFB14:
 332:./tmk_core/common/action_tapping.c **** {
 120               		.loc 1 332 6 view -0
 121               		.cfi_startproc
 122               	/* prologue: function */
 123               	/* frame size = 0 */
 124               	/* stack size = 0 */
 125               	.L__stack_usage = 0
 334:./tmk_core/common/action_tapping.c ****         if (KEYEQ(event.key, waiting_buffer[i].event.key) && event.pressed !=  waiting_buffer[i].ev
 126               		.loc 1 334 5 view .LVU23
 127               	.LBB5:
 334:./tmk_core/common/action_tapping.c ****         if (KEYEQ(event.key, waiting_buffer[i].event.key) && event.pressed !=  waiting_buffer[i].ev
 128               		.loc 1 334 10 view .LVU24
 334:./tmk_core/common/action_tapping.c ****         if (KEYEQ(event.key, waiting_buffer[i].event.key) && event.pressed !=  waiting_buffer[i].ev
 129               		.loc 1 334 18 is_stmt 0 view .LVU25
 130 0000 E091 0000 		lds r30,waiting_buffer_tail
 131               	.LVL6:
 334:./tmk_core/common/action_tapping.c ****         if (KEYEQ(event.key, waiting_buffer[i].event.key) && event.pressed !=  waiting_buffer[i].ev
 132               		.loc 1 334 45 view .LVU26
 133 0004 9091 0000 		lds r25,waiting_buffer_head
 335:./tmk_core/common/action_tapping.c ****             return true;
 134               		.loc 1 335 13 view .LVU27
 135 0008 56E0      		ldi r21,lo8(6)
 136               	.LVL7:
 137               	.L6:
 334:./tmk_core/common/action_tapping.c ****         if (KEYEQ(event.key, waiting_buffer[i].event.key) && event.pressed !=  waiting_buffer[i].ev
 138               		.loc 1 334 43 is_stmt 1 view .LVU28
 334:./tmk_core/common/action_tapping.c ****         if (KEYEQ(event.key, waiting_buffer[i].event.key) && event.pressed !=  waiting_buffer[i].ev
 139               		.loc 1 334 5 is_stmt 0 view .LVU29
 140 000a E913      		cpse r30,r25
 141 000c 00C0      		rjmp .L9
 142               	.LBE5:
 339:./tmk_core/common/action_tapping.c **** }
 143               		.loc 1 339 12 view .LVU30
 144 000e 80E0      		ldi r24,0
 145               	.LBB6:
 146 0010 0895      		ret
 147               	.L9:
 335:./tmk_core/common/action_tapping.c ****             return true;
 148               		.loc 1 335 9 is_stmt 1 view .LVU31
 335:./tmk_core/common/action_tapping.c ****             return true;
 149               		.loc 1 335 13 is_stmt 0 view .LVU32
 150 0012 2E2F      		mov r18,r30
 151 0014 30E0      		ldi r19,0
 152 0016 5E9F      		mul r21,r30
 153 0018 F001      		movw r30,r0
 154 001a 1124      		clr __zero_reg__
 155               	.LVL8:
 335:./tmk_core/common/action_tapping.c ****             return true;
 156               		.loc 1 335 13 view .LVU33
 157 001c E050      		subi r30,lo8(-(waiting_buffer))
 158 001e F040      		sbci r31,hi8(-(waiting_buffer))
 335:./tmk_core/common/action_tapping.c ****             return true;
 159               		.loc 1 335 12 view .LVU34
 160 0020 7181      		ldd r23,Z+1
 161 0022 7613      		cpse r23,r22
 162 0024 00C0      		rjmp .L7
 335:./tmk_core/common/action_tapping.c ****             return true;
 163               		.loc 1 335 13 view .LVU35
 164 0026 7081      		ld r23,Z
 165 0028 7813      		cpse r23,r24
 166 002a 00C0      		rjmp .L7
 335:./tmk_core/common/action_tapping.c ****             return true;
 167               		.loc 1 335 59 view .LVU36
 168 002c 7281      		ldd r23,Z+2
 169 002e 7413      		cpse r23,r20
 170 0030 00C0      		rjmp .L10
 171               	.L7:
 334:./tmk_core/common/action_tapping.c ****         if (KEYEQ(event.key, waiting_buffer[i].event.key) && event.pressed !=  waiting_buffer[i].ev
 172               		.loc 1 334 69 is_stmt 1 view .LVU37
 334:./tmk_core/common/action_tapping.c ****         if (KEYEQ(event.key, waiting_buffer[i].event.key) && event.pressed !=  waiting_buffer[i].ev
 173               		.loc 1 334 76 is_stmt 0 view .LVU38
 174 0032 F901      		movw r30,r18
 175 0034 3196      		adiw r30,1
 334:./tmk_core/common/action_tapping.c ****         if (KEYEQ(event.key, waiting_buffer[i].event.key) && event.pressed !=  waiting_buffer[i].ev
 176               		.loc 1 334 71 view .LVU39
 177 0036 E770      		andi r30,lo8(7)
 178               	.LVL9:
 334:./tmk_core/common/action_tapping.c ****         if (KEYEQ(event.key, waiting_buffer[i].event.key) && event.pressed !=  waiting_buffer[i].ev
 179               		.loc 1 334 71 view .LVU40
 180 0038 00C0      		rjmp .L6
 181               	.LVL10:
 182               	.L10:
 336:./tmk_core/common/action_tapping.c ****         }
 183               		.loc 1 336 20 view .LVU41
 184 003a 81E0      		ldi r24,lo8(1)
 185               	/* epilogue start */
 186               	.LBE6:
 340:./tmk_core/common/action_tapping.c **** 
 187               		.loc 1 340 1 view .LVU42
 188 003c 0895      		ret
 189               		.cfi_endproc
 190               	.LFE14:
 192               		.section	.text.waiting_buffer_scan_tap,"ax",@progbits
 194               	waiting_buffer_scan_tap:
 195               	.LFB10:
 360:./tmk_core/common/action_tapping.c ****     // tapping already is settled
 196               		.loc 1 360 1 is_stmt 1 view -0
 197               		.cfi_startproc
 198 0000 1F93      		push r17
 199               	.LCFI3:
 200               		.cfi_def_cfa_offset 3
 201               		.cfi_offset 17, -2
 202 0002 CF93      		push r28
 203               	.LCFI4:
 204               		.cfi_def_cfa_offset 4
 205               		.cfi_offset 28, -3
 206 0004 DF93      		push r29
 207               	.LCFI5:
 208               		.cfi_def_cfa_offset 5
 209               		.cfi_offset 29, -4
 210               	/* prologue: function */
 211               	/* frame size = 0 */
 212               	/* stack size = 3 */
 213               	.L__stack_usage = 3
 362:./tmk_core/common/action_tapping.c ****     // invalid state: tapping_key released && tap.count == 0
 214               		.loc 1 362 5 view .LVU44
 362:./tmk_core/common/action_tapping.c ****     // invalid state: tapping_key released && tap.count == 0
 215               		.loc 1 362 31 is_stmt 0 view .LVU45
 216 0006 8091 0000 		lds r24,tapping_key+5
 217 000a 807F      		andi r24,lo8(-16)
 362:./tmk_core/common/action_tapping.c ****     // invalid state: tapping_key released && tap.count == 0
 218               		.loc 1 362 8 view .LVU46
 219 000c 01F4      		brne .L11
 364:./tmk_core/common/action_tapping.c **** 
 220               		.loc 1 364 5 is_stmt 1 view .LVU47
 364:./tmk_core/common/action_tapping.c **** 
 221               		.loc 1 364 8 is_stmt 0 view .LVU48
 222 000e 8091 0000 		lds r24,tapping_key+2
 223 0012 8823      		tst r24
 224 0014 01F0      		breq .L11
 366:./tmk_core/common/action_tapping.c ****         if (IS_TAPPING_KEY(waiting_buffer[i].event.key) &&
 225               		.loc 1 366 5 is_stmt 1 view .LVU49
 226               	.LBB10:
 366:./tmk_core/common/action_tapping.c ****         if (IS_TAPPING_KEY(waiting_buffer[i].event.key) &&
 227               		.loc 1 366 10 view .LVU50
 366:./tmk_core/common/action_tapping.c ****         if (IS_TAPPING_KEY(waiting_buffer[i].event.key) &&
 228               		.loc 1 366 18 is_stmt 0 view .LVU51
 229 0016 8091 0000 		lds r24,waiting_buffer_tail
 230               	.LVL11:
 366:./tmk_core/common/action_tapping.c ****         if (IS_TAPPING_KEY(waiting_buffer[i].event.key) &&
 231               		.loc 1 366 45 view .LVU52
 232 001a C091 0000 		lds r28,waiting_buffer_head
 367:./tmk_core/common/action_tapping.c ****                 !waiting_buffer[i].event.pressed &&
 233               		.loc 1 367 13 view .LVU53
 234 001e 6091 0000 		lds r22,tapping_key
 235 0022 7091 0000 		lds r23,tapping_key+1
 236 0026 4091 0000 		lds r20,tapping_key+3
 237 002a 5091 0000 		lds r21,tapping_key+3+1
 238 002e D62F      		mov r29,r22
 239 0030 D723      		and r29,r23
 240 0032 DA01      		movw r26,r20
 241 0034 A095      		com r26
 242 0036 B095      		com r27
 243 0038 16E0      		ldi r17,lo8(6)
 244               	.LVL12:
 245               	.L13:
 366:./tmk_core/common/action_tapping.c ****         if (IS_TAPPING_KEY(waiting_buffer[i].event.key) &&
 246               		.loc 1 366 43 is_stmt 1 discriminator 1 view .LVU54
 366:./tmk_core/common/action_tapping.c ****         if (IS_TAPPING_KEY(waiting_buffer[i].event.key) &&
 247               		.loc 1 366 5 is_stmt 0 discriminator 1 view .LVU55
 248 003a C813      		cpse r28,r24
 249 003c 00C0      		rjmp .L20
 250               	.LVL13:
 251               	.L11:
 252               	/* epilogue start */
 366:./tmk_core/common/action_tapping.c ****         if (IS_TAPPING_KEY(waiting_buffer[i].event.key) &&
 253               		.loc 1 366 5 discriminator 1 view .LVU56
 254               	.LBE10:
 379:./tmk_core/common/action_tapping.c **** 
 255               		.loc 1 379 1 view .LVU57
 256 003e DF91      		pop r29
 257 0040 CF91      		pop r28
 258 0042 1F91      		pop r17
 259 0044 0895      		ret
 260               	.LVL14:
 261               	.L20:
 262               	.LBB13:
 367:./tmk_core/common/action_tapping.c ****                 !waiting_buffer[i].event.pressed &&
 263               		.loc 1 367 9 is_stmt 1 view .LVU58
 264               	.LBB11:
 265               	.LBI11:
 266               		.file 2 "./tmk_core/common/keyboard.h"
   1:./tmk_core/common/keyboard.h **** /*
   2:./tmk_core/common/keyboard.h **** Copyright 2011,2012,2013 Jun Wako <wakojun@gmail.com>
   3:./tmk_core/common/keyboard.h **** 
   4:./tmk_core/common/keyboard.h **** This program is free software: you can redistribute it and/or modify
   5:./tmk_core/common/keyboard.h **** it under the terms of the GNU General Public License as published by
   6:./tmk_core/common/keyboard.h **** the Free Software Foundation, either version 2 of the License, or
   7:./tmk_core/common/keyboard.h **** (at your option) any later version.
   8:./tmk_core/common/keyboard.h **** 
   9:./tmk_core/common/keyboard.h **** This program is distributed in the hope that it will be useful,
  10:./tmk_core/common/keyboard.h **** but WITHOUT ANY WARRANTY; without even the implied warranty of
  11:./tmk_core/common/keyboard.h **** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  12:./tmk_core/common/keyboard.h **** GNU General Public License for more details.
  13:./tmk_core/common/keyboard.h **** 
  14:./tmk_core/common/keyboard.h **** You should have received a copy of the GNU General Public License
  15:./tmk_core/common/keyboard.h **** along with this program.  If not, see <http://www.gnu.org/licenses/>.
  16:./tmk_core/common/keyboard.h **** */
  17:./tmk_core/common/keyboard.h **** 
  18:./tmk_core/common/keyboard.h **** #ifndef KEYBOARD_H
  19:./tmk_core/common/keyboard.h **** #define KEYBOARD_H
  20:./tmk_core/common/keyboard.h **** 
  21:./tmk_core/common/keyboard.h **** #include <stdbool.h>
  22:./tmk_core/common/keyboard.h **** #include <stdint.h>
  23:./tmk_core/common/keyboard.h **** 
  24:./tmk_core/common/keyboard.h **** 
  25:./tmk_core/common/keyboard.h **** #ifdef __cplusplus
  26:./tmk_core/common/keyboard.h **** extern "C" {
  27:./tmk_core/common/keyboard.h **** #endif
  28:./tmk_core/common/keyboard.h **** 
  29:./tmk_core/common/keyboard.h **** /* key matrix position */
  30:./tmk_core/common/keyboard.h **** typedef struct {
  31:./tmk_core/common/keyboard.h ****     uint8_t col;
  32:./tmk_core/common/keyboard.h ****     uint8_t row;
  33:./tmk_core/common/keyboard.h **** } keypos_t;
  34:./tmk_core/common/keyboard.h **** 
  35:./tmk_core/common/keyboard.h **** /* key event */
  36:./tmk_core/common/keyboard.h **** typedef struct {
  37:./tmk_core/common/keyboard.h ****     keypos_t key;
  38:./tmk_core/common/keyboard.h ****     bool     pressed;
  39:./tmk_core/common/keyboard.h ****     uint16_t time;
  40:./tmk_core/common/keyboard.h **** } keyevent_t;
  41:./tmk_core/common/keyboard.h **** 
  42:./tmk_core/common/keyboard.h **** /* equivalent test of keypos_t */
  43:./tmk_core/common/keyboard.h **** #define KEYEQ(keya, keyb)       ((keya).row == (keyb).row && (keya).col == (keyb).col)
  44:./tmk_core/common/keyboard.h **** 
  45:./tmk_core/common/keyboard.h **** /* Rules for No Event:
  46:./tmk_core/common/keyboard.h ****  * 1) (time == 0) to handle (keyevent_t){} as empty event
  47:./tmk_core/common/keyboard.h ****  * 2) Matrix(255, 255) to make TICK event available
  48:./tmk_core/common/keyboard.h ****  */
  49:./tmk_core/common/keyboard.h **** static inline bool IS_NOEVENT(keyevent_t event) { return event.time == 0 || (event.key.row == 255 &
 267               		.loc 2 49 20 view .LVU59
 268               	.LBB12:
 269               		.loc 2 49 51 view .LVU60
 270 0046 90E0      		ldi r25,0
 271               		.loc 2 49 74 is_stmt 0 view .LVU61
 272 0048 4115      		cp r20,__zero_reg__
 273 004a 5105      		cpc r21,__zero_reg__
 274 004c 01F0      		breq .L14
 275 004e DF3F      		cpi r29,lo8(-1)
 276 0050 01F4      		brne .L33
 277               	.L14:
 278               	.LBE12:
 279               	.LBE11:
 366:./tmk_core/common/action_tapping.c ****         if (IS_TAPPING_KEY(waiting_buffer[i].event.key) &&
 280               		.loc 1 366 69 is_stmt 1 discriminator 2 view .LVU62
 366:./tmk_core/common/action_tapping.c ****         if (IS_TAPPING_KEY(waiting_buffer[i].event.key) &&
 281               		.loc 1 366 76 is_stmt 0 discriminator 2 view .LVU63
 282 0052 0196      		adiw r24,1
 283               	.LVL15:
 366:./tmk_core/common/action_tapping.c ****         if (IS_TAPPING_KEY(waiting_buffer[i].event.key) &&
 284               		.loc 1 366 71 discriminator 2 view .LVU64
 285 0054 8770      		andi r24,lo8(7)
 366:./tmk_core/common/action_tapping.c ****         if (IS_TAPPING_KEY(waiting_buffer[i].event.key) &&
 286               		.loc 1 366 71 discriminator 2 view .LVU65
 287 0056 00C0      		rjmp .L13
 288               	.LVL16:
 289               	.L16:
 369:./tmk_core/common/action_tapping.c ****             tapping_key.tap.count = 1;
 290               		.loc 1 369 17 discriminator 2 view .LVU66
 291 0058 2A0F      		add r18,r26
 292 005a 3B1F      		adc r19,r27
 293 005c 00C0      		rjmp .L34
 294               	.L33:
 367:./tmk_core/common/action_tapping.c ****                 !waiting_buffer[i].event.pressed &&
 295               		.loc 1 367 13 view .LVU67
 296 005e 189F      		mul r17,r24
 297 0060 F001      		movw r30,r0
 298 0062 199F      		mul r17,r25
 299 0064 F00D      		add r31,r0
 300 0066 1124      		clr __zero_reg__
 301 0068 E050      		subi r30,lo8(-(waiting_buffer))
 302 006a F040      		sbci r31,hi8(-(waiting_buffer))
 303 006c 2181      		ldd r18,Z+1
 304 006e 2713      		cpse r18,r23
 305 0070 00C0      		rjmp .L14
 367:./tmk_core/common/action_tapping.c ****                 !waiting_buffer[i].event.pressed &&
 306               		.loc 1 367 13 discriminator 2 view .LVU68
 307 0072 2081      		ld r18,Z
 308 0074 2613      		cpse r18,r22
 309 0076 00C0      		rjmp .L14
 367:./tmk_core/common/action_tapping.c ****                 !waiting_buffer[i].event.pressed &&
 310               		.loc 1 367 57 discriminator 3 view .LVU69
 311 0078 2281      		ldd r18,Z+2
 312 007a 2111      		cpse r18,__zero_reg__
 313 007c 00C0      		rjmp .L14
 369:./tmk_core/common/action_tapping.c ****             tapping_key.tap.count = 1;
 314               		.loc 1 369 17 view .LVU70
 315 007e 2381      		ldd r18,Z+3
 316 0080 3481      		ldd r19,Z+4
 317 0082 2417      		cp r18,r20
 318 0084 3507      		cpc r19,r21
 319 0086 00F0      		brlo .L16
 369:./tmk_core/common/action_tapping.c ****             tapping_key.tap.count = 1;
 320               		.loc 1 369 17 discriminator 1 view .LVU71
 321 0088 241B      		sub r18,r20
 322 008a 350B      		sbc r19,r21
 323               	.L34:
 369:./tmk_core/common/action_tapping.c ****             tapping_key.tap.count = 1;
 324               		.loc 1 369 17 discriminator 2 view .LVU72
 325 008c 2639      		cpi r18,-106
 326 008e 3105      		cpc r19,__zero_reg__
 327 0090 00F4      		brsh .L14
 370:./tmk_core/common/action_tapping.c ****             waiting_buffer[i].tap.count = 1;
 328               		.loc 1 370 13 is_stmt 1 view .LVU73
 370:./tmk_core/common/action_tapping.c ****             waiting_buffer[i].tap.count = 1;
 329               		.loc 1 370 35 is_stmt 0 view .LVU74
 330 0092 2091 0000 		lds r18,tapping_key+5
 331 0096 2F70      		andi r18,lo8(15)
 332 0098 2061      		ori r18,lo8(16)
 333 009a 2093 0000 		sts tapping_key+5,r18
 371:./tmk_core/common/action_tapping.c ****             process_record(&tapping_key);
 334               		.loc 1 371 13 is_stmt 1 view .LVU75
 371:./tmk_core/common/action_tapping.c ****             process_record(&tapping_key);
 335               		.loc 1 371 41 is_stmt 0 view .LVU76
 336 009e 26E0      		ldi r18,lo8(6)
 337 00a0 289F      		mul r18,r24
 338 00a2 F001      		movw r30,r0
 339 00a4 299F      		mul r18,r25
 340 00a6 F00D      		add r31,r0
 341 00a8 1124      		clr __zero_reg__
 342 00aa E050      		subi r30,lo8(-(waiting_buffer+5))
 343 00ac F040      		sbci r31,hi8(-(waiting_buffer+5))
 344 00ae 8081      		ld r24,Z
 345               	.LVL17:
 371:./tmk_core/common/action_tapping.c ****             process_record(&tapping_key);
 346               		.loc 1 371 41 view .LVU77
 347 00b0 8F70      		andi r24,lo8(15)
 348 00b2 8061      		ori r24,lo8(16)
 349 00b4 8083      		st Z,r24
 372:./tmk_core/common/action_tapping.c **** 
 350               		.loc 1 372 13 is_stmt 1 view .LVU78
 351 00b6 80E0      		ldi r24,lo8(tapping_key)
 352 00b8 90E0      		ldi r25,hi8(tapping_key)
 353 00ba 0E94 0000 		call process_record
 354               	.LVL18:
 374:./tmk_core/common/action_tapping.c ****             debug_waiting_buffer();
 355               		.loc 1 374 57 view .LVU79
 374:./tmk_core/common/action_tapping.c ****             debug_waiting_buffer();
 356               		.loc 1 374 71 view .LVU80
 374:./tmk_core/common/action_tapping.c ****             debug_waiting_buffer();
 357               		.loc 1 374 85 view .LVU81
 375:./tmk_core/common/action_tapping.c ****             return;
 358               		.loc 1 375 13 view .LVU82
 359               	/* epilogue start */
 360               	.LBE13:
 379:./tmk_core/common/action_tapping.c **** 
 361               		.loc 1 379 1 is_stmt 0 view .LVU83
 362 00be DF91      		pop r29
 363 00c0 CF91      		pop r28
 364 00c2 1F91      		pop r17
 365               	.LBB14:
 375:./tmk_core/common/action_tapping.c ****             return;
 366               		.loc 1 375 13 view .LVU84
 367 00c4 0C94 0000 		jmp debug_waiting_buffer
 368               	.LVL19:
 369               	.LBE14:
 370               		.cfi_endproc
 371               	.LFE10:
 373               		.section	.text.process_tapping,"ax",@progbits
 375               	process_tapping:
 376               	.LVL20:
 377               	.LFB5:
  84:./tmk_core/common/action_tapping.c ****     keyevent_t event = keyp->event;
 378               		.loc 1 84 1 is_stmt 1 view -0
 379               		.cfi_startproc
  84:./tmk_core/common/action_tapping.c ****     keyevent_t event = keyp->event;
 380               		.loc 1 84 1 is_stmt 0 view .LVU86
 381 0000 7F92      		push r7
 382               	.LCFI6:
 383               		.cfi_def_cfa_offset 3
 384               		.cfi_offset 7, -2
 385 0002 8F92      		push r8
 386               	.LCFI7:
 387               		.cfi_def_cfa_offset 4
 388               		.cfi_offset 8, -3
 389 0004 9F92      		push r9
 390               	.LCFI8:
 391               		.cfi_def_cfa_offset 5
 392               		.cfi_offset 9, -4
 393 0006 AF92      		push r10
 394               	.LCFI9:
 395               		.cfi_def_cfa_offset 6
 396               		.cfi_offset 10, -5
 397 0008 BF92      		push r11
 398               	.LCFI10:
 399               		.cfi_def_cfa_offset 7
 400               		.cfi_offset 11, -6
 401 000a CF92      		push r12
 402               	.LCFI11:
 403               		.cfi_def_cfa_offset 8
 404               		.cfi_offset 12, -7
 405 000c DF92      		push r13
 406               	.LCFI12:
 407               		.cfi_def_cfa_offset 9
 408               		.cfi_offset 13, -8
 409 000e EF92      		push r14
 410               	.LCFI13:
 411               		.cfi_def_cfa_offset 10
 412               		.cfi_offset 14, -9
 413 0010 FF92      		push r15
 414               	.LCFI14:
 415               		.cfi_def_cfa_offset 11
 416               		.cfi_offset 15, -10
 417 0012 0F93      		push r16
 418               	.LCFI15:
 419               		.cfi_def_cfa_offset 12
 420               		.cfi_offset 16, -11
 421 0014 1F93      		push r17
 422               	.LCFI16:
 423               		.cfi_def_cfa_offset 13
 424               		.cfi_offset 17, -12
 425 0016 CF93      		push r28
 426               	.LCFI17:
 427               		.cfi_def_cfa_offset 14
 428               		.cfi_offset 28, -13
 429 0018 DF93      		push r29
 430               	.LCFI18:
 431               		.cfi_def_cfa_offset 15
 432               		.cfi_offset 29, -14
 433 001a CDB7      		in r28,__SP_L__
 434 001c DEB7      		in r29,__SP_H__
 435               	.LCFI19:
 436               		.cfi_def_cfa_register 28
 437 001e 2B97      		sbiw r28,11
 438               	.LCFI20:
 439               		.cfi_def_cfa_offset 26
 440 0020 0FB6      		in __tmp_reg__,__SREG__
 441 0022 F894      		cli
 442 0024 DEBF      		out __SP_H__,r29
 443 0026 0FBE      		out __SREG__,__tmp_reg__
 444 0028 CDBF      		out __SP_L__,r28
 445               	/* prologue: function */
 446               	/* frame size = 11 */
 447               	/* stack size = 24 */
 448               	.L__stack_usage = 24
 449 002a 8C01      		movw r16,r24
  85:./tmk_core/common/action_tapping.c **** 
 450               		.loc 1 85 5 is_stmt 1 view .LVU87
  85:./tmk_core/common/action_tapping.c **** 
 451               		.loc 1 85 16 is_stmt 0 view .LVU88
 452 002c 85E0      		ldi r24,lo8(5)
 453               	.LVL21:
  85:./tmk_core/common/action_tapping.c **** 
 454               		.loc 1 85 16 view .LVU89
 455 002e F801      		movw r30,r16
 456 0030 DE01      		movw r26,r28
 457 0032 1796      		adiw r26,7
 458               		0:
 459 0034 0190      		ld r0,Z+
 460 0036 0D92      		st X+,r0
 461 0038 8A95      		dec r24
 462 003a 01F4      		brne 0b
 463 003c D801      		movw r26,r16
 464 003e EC90      		ld r14,X
 465               	.LVL22:
  85:./tmk_core/common/action_tapping.c **** 
 466               		.loc 1 85 16 view .LVU90
 467 0040 1196      		adiw r26,1
 468 0042 DC90      		ld r13,X
 469 0044 1197      		sbiw r26,1
 470               	.LVL23:
  85:./tmk_core/common/action_tapping.c **** 
 471               		.loc 1 85 16 view .LVU91
 472 0046 1296      		adiw r26,2
 473 0048 CC90      		ld r12,X
 474 004a 1297      		sbiw r26,2
 475               	.LVL24:
  88:./tmk_core/common/action_tapping.c ****         if (WITHIN_TAPPING_TERM(event)) {
 476               		.loc 1 88 5 is_stmt 1 view .LVU92
  88:./tmk_core/common/action_tapping.c ****         if (WITHIN_TAPPING_TERM(event)) {
 477               		.loc 1 88 9 is_stmt 0 view .LVU93
 478 004c 8091 0000 		lds r24,tapping_key+3
 479 0050 9091 0000 		lds r25,tapping_key+3+1
 480               	.LBB32:
 481               	.LBI32:
 482               		.loc 2 49 20 is_stmt 1 view .LVU94
 483               	.LBB33:
 484               		.loc 2 49 51 view .LVU95
 485               		.loc 2 49 74 is_stmt 0 view .LVU96
 486 0054 0097      		sbiw r24,0
 487 0056 01F4      		brne .+2
 488 0058 00C0      		rjmp .L36
 489               	.LBE33:
 490               	.LBE32:
  88:./tmk_core/common/action_tapping.c ****         if (WITHIN_TAPPING_TERM(event)) {
 491               		.loc 1 88 9 view .LVU97
 492 005a 2091 0000 		lds r18,tapping_key
 493 005e 3091 0000 		lds r19,tapping_key+1
 494               	.LBB35:
 495               	.LBB34:
 496               		.loc 2 49 74 view .LVU98
 497 0062 432F      		mov r20,r19
 498 0064 4223      		and r20,r18
 499 0066 4F3F      		cpi r20,lo8(-1)
 500 0068 01F4      		brne .+2
 501 006a 00C0      		rjmp .L36
 502               	.LBE34:
 503               	.LBE35:
  85:./tmk_core/common/action_tapping.c **** 
 504               		.loc 1 85 16 discriminator 1 view .LVU99
 505 006c 1396      		adiw r26,3
 506 006e AD90      		ld r10,X+
 507 0070 BC90      		ld r11,X
  88:./tmk_core/common/action_tapping.c ****         if (WITHIN_TAPPING_TERM(event)) {
 508               		.loc 1 88 9 discriminator 1 view .LVU100
 509 0072 7090 0000 		lds r7,tapping_key+2
 510 0076 7720      		tst r7
 511 0078 01F4      		brne .+2
 512 007a 00C0      		rjmp .L37
  89:./tmk_core/common/action_tapping.c ****             if (tapping_key.tap.count == 0) {
 513               		.loc 1 89 9 is_stmt 1 view .LVU101
  89:./tmk_core/common/action_tapping.c ****             if (tapping_key.tap.count == 0) {
 514               		.loc 1 89 13 is_stmt 0 view .LVU102
 515 007c A816      		cp r10,r24
 516 007e B906      		cpc r11,r25
 517 0080 00F4      		brsh .+2
 518 0082 00C0      		rjmp .L38
  89:./tmk_core/common/action_tapping.c ****             if (tapping_key.tap.count == 0) {
 519               		.loc 1 89 13 discriminator 1 view .LVU103
 520 0084 F501      		movw r30,r10
 521 0086 E81B      		sub r30,r24
 522 0088 F90B      		sbc r31,r25
 523 008a CF01      		movw r24,r30
 524               	.L136:
  89:./tmk_core/common/action_tapping.c ****             if (tapping_key.tap.count == 0) {
 525               		.loc 1 89 13 discriminator 2 view .LVU104
 526 008c FF24      		clr r15
 527 008e F394      		inc r15
 528 0090 8639      		cpi r24,-106
 529 0092 9105      		cpc r25,__zero_reg__
 530 0094 00F0      		brlo .L40
 531 0096 F12C      		mov r15,__zero_reg__
 532               	.L40:
 533 0098 80E0      		ldi r24,lo8(tapping_key)
 534 009a 882E      		mov r8,r24
 535 009c 80E0      		ldi r24,hi8(tapping_key)
 536 009e 982E      		mov r9,r24
 537 00a0 8091 0000 		lds r24,tapping_key+5
 538 00a4 982F      		mov r25,r24
 539 00a6 907F      		andi r25,lo8(-16)
  89:./tmk_core/common/action_tapping.c ****             if (tapping_key.tap.count == 0) {
 540               		.loc 1 89 12 discriminator 4 view .LVU105
 541 00a8 FF20      		tst r15
 542 00aa 01F4      		brne .+2
 543 00ac 00C0      		rjmp .L42
  90:./tmk_core/common/action_tapping.c ****                 if (IS_TAPPING_KEY(event.key) && !event.pressed) {
 544               		.loc 1 90 13 is_stmt 1 view .LVU106
  90:./tmk_core/common/action_tapping.c ****                 if (IS_TAPPING_KEY(event.key) && !event.pressed) {
 545               		.loc 1 90 16 is_stmt 0 view .LVU107
 546 00ae 9111      		cpse r25,__zero_reg__
 547 00b0 00C0      		rjmp .L43
  91:./tmk_core/common/action_tapping.c ****                     // first tap!
 548               		.loc 1 91 17 is_stmt 1 discriminator 1 view .LVU108
 549 00b2 FC2C      		mov r15,r12
  91:./tmk_core/common/action_tapping.c ****                     // first tap!
 550               		.loc 1 91 21 is_stmt 0 discriminator 1 view .LVU109
 551 00b4 3D11      		cpse r19,r13
 552 00b6 00C0      		rjmp .L44
  91:./tmk_core/common/action_tapping.c ****                     // first tap!
 553               		.loc 1 91 21 discriminator 2 view .LVU110
 554 00b8 2E11      		cpse r18,r14
 555 00ba 00C0      		rjmp .L44
  91:./tmk_core/common/action_tapping.c ****                     // first tap!
 556               		.loc 1 91 47 discriminator 3 view .LVU111
 557 00bc C110      		cpse r12,__zero_reg__
 558 00be 00C0      		rjmp .L44
  93:./tmk_core/common/action_tapping.c ****                     tapping_key.tap.count = 1;
 559               		.loc 1 93 57 is_stmt 1 view .LVU112
  94:./tmk_core/common/action_tapping.c ****                     debug_tapping_key();
 560               		.loc 1 94 21 view .LVU113
  94:./tmk_core/common/action_tapping.c ****                     debug_tapping_key();
 561               		.loc 1 94 43 is_stmt 0 view .LVU114
 562 00c0 8F70      		andi r24,lo8(15)
 563 00c2 8061      		ori r24,lo8(16)
 564 00c4 8093 0000 		sts tapping_key+5,r24
 565               	.LVL25:
  95:./tmk_core/common/action_tapping.c ****                     process_record(&tapping_key);
 566               		.loc 1 95 21 is_stmt 1 view .LVU115
 567 00c8 0E94 0000 		call debug_tapping_key
 568               	.LVL26:
  96:./tmk_core/common/action_tapping.c **** 
 569               		.loc 1 96 21 view .LVU116
 570 00cc C401      		movw r24,r8
 571 00ce 0E94 0000 		call process_record
 572               	.LVL27:
  99:./tmk_core/common/action_tapping.c ****                     // enqueue
 573               		.loc 1 99 21 view .LVU117
  99:./tmk_core/common/action_tapping.c ****                     // enqueue
 574               		.loc 1 99 31 is_stmt 0 view .LVU118
 575 00d2 8091 0000 		lds r24,tapping_key+5
 576 00d6 D801      		movw r26,r16
 577 00d8 1596      		adiw r26,5
 578 00da 8C93      		st X,r24
 101:./tmk_core/common/action_tapping.c ****                 }
 579               		.loc 1 101 21 is_stmt 1 view .LVU119
 580               	.LVL28:
 581               	.L35:
 293:./tmk_core/common/action_tapping.c **** 
 582               		.loc 1 293 1 is_stmt 0 view .LVU120
 583 00dc 8F2D      		mov r24,r15
 584               	/* epilogue start */
 293:./tmk_core/common/action_tapping.c **** 
 585               		.loc 1 293 1 view .LVU121
 586 00de 2B96      		adiw r28,11
 587 00e0 0FB6      		in __tmp_reg__,__SREG__
 588 00e2 F894      		cli
 589 00e4 DEBF      		out __SP_H__,r29
 590 00e6 0FBE      		out __SREG__,__tmp_reg__
 591 00e8 CDBF      		out __SP_L__,r28
 592 00ea DF91      		pop r29
 593 00ec CF91      		pop r28
 594 00ee 1F91      		pop r17
 595 00f0 0F91      		pop r16
 596               	.LVL29:
 293:./tmk_core/common/action_tapping.c **** 
 597               		.loc 1 293 1 view .LVU122
 598 00f2 FF90      		pop r15
 599 00f4 EF90      		pop r14
 293:./tmk_core/common/action_tapping.c **** 
 600               		.loc 1 293 1 view .LVU123
 601 00f6 DF90      		pop r13
 293:./tmk_core/common/action_tapping.c **** 
 602               		.loc 1 293 1 view .LVU124
 603 00f8 CF90      		pop r12
 604               	.LVL30:
 293:./tmk_core/common/action_tapping.c **** 
 605               		.loc 1 293 1 view .LVU125
 606 00fa BF90      		pop r11
 607 00fc AF90      		pop r10
 608 00fe 9F90      		pop r9
 609 0100 8F90      		pop r8
 610 0102 7F90      		pop r7
 611 0104 0895      		ret
 612               	.LVL31:
 613               	.L38:
  89:./tmk_core/common/action_tapping.c ****             if (tapping_key.tap.count == 0) {
 614               		.loc 1 89 13 discriminator 2 view .LVU126
 615 0106 8095      		com r24
 616 0108 9095      		com r25
 617 010a 8A0D      		add r24,r10
 618 010c 9B1D      		adc r25,r11
 619 010e 00C0      		rjmp .L136
 620               	.L44:
 108:./tmk_core/common/action_tapping.c ****                     debug("Tapping: End. No tap. Interfered by typing key\n");
 621               		.loc 1 108 22 is_stmt 1 view .LVU127
 622               	.LVL32:
 623               	.LBB36:
 624               	.LBI36:
  50:./tmk_core/common/keyboard.h **** static inline bool IS_PRESSED(keyevent_t event) { return (!IS_NOEVENT(event) && event.pressed); }
  51:./tmk_core/common/keyboard.h **** static inline bool IS_RELEASED(keyevent_t event) { return (!IS_NOEVENT(event) && !event.pressed); }
 625               		.loc 2 51 20 view .LVU128
 626               	.LBB37:
 627               		.loc 2 51 52 view .LVU129
 628               	.LBB38:
 629               	.LBI38:
  49:./tmk_core/common/keyboard.h **** static inline bool IS_PRESSED(keyevent_t event) { return (!IS_NOEVENT(event) && event.pressed); }
 630               		.loc 2 49 20 view .LVU130
 631               	.LBB39:
  49:./tmk_core/common/keyboard.h **** static inline bool IS_PRESSED(keyevent_t event) { return (!IS_NOEVENT(event) && event.pressed); }
 632               		.loc 2 49 51 view .LVU131
  49:./tmk_core/common/keyboard.h **** static inline bool IS_PRESSED(keyevent_t event) { return (!IS_NOEVENT(event) && event.pressed); }
 633               		.loc 2 49 74 is_stmt 0 view .LVU132
 634 0110 A114      		cp r10,__zero_reg__
 635 0112 B104      		cpc r11,__zero_reg__
 636 0114 01F0      		breq .L74
 637 0116 8E2D      		mov r24,r14
 638 0118 8D21      		and r24,r13
 639 011a 8F3F      		cpi r24,lo8(-1)
 640 011c 01F0      		breq .+2
 641 011e 00C0      		rjmp .L47
 642               	.L74:
  49:./tmk_core/common/keyboard.h **** static inline bool IS_PRESSED(keyevent_t event) { return (!IS_NOEVENT(event) && event.pressed); }
 643               		.loc 2 49 74 view .LVU133
 644               	.LBE39:
 645               	.LBE38:
 646               		.loc 2 51 79 view .LVU134
 647 0120 80E0      		ldi r24,0
 648               	.L46:
 649               	.LVL33:
 650               		.loc 2 51 79 view .LVU135
 651               	.LBE37:
 652               	.LBE36:
 108:./tmk_core/common/action_tapping.c ****                     debug("Tapping: End. No tap. Interfered by typing key\n");
 653               		.loc 1 108 25 view .LVU136
 654 0122 80FF      		sbrs r24,0
 655 0124 00C0      		rjmp .L48
 108:./tmk_core/common/action_tapping.c ****                     debug("Tapping: End. No tap. Interfered by typing key\n");
 656               		.loc 1 108 48 discriminator 1 view .LVU137
 657 0126 4C2D      		mov r20,r12
 658 0128 6D2D      		mov r22,r13
 659 012a 8E2D      		mov r24,r14
 660 012c 0E94 0000 		call waiting_buffer_typed.isra.0
 661               	.LVL34:
 108:./tmk_core/common/action_tapping.c ****                     debug("Tapping: End. No tap. Interfered by typing key\n");
 662               		.loc 1 108 45 discriminator 1 view .LVU138
 663 0130 8823      		tst r24
 664 0132 01F0      		breq .L48
 665               	.LBB41:
 109:./tmk_core/common/action_tapping.c ****                     process_record(&tapping_key);
 666               		.loc 1 109 78 is_stmt 1 view .LVU139
 110:./tmk_core/common/action_tapping.c ****                     tapping_key = (keyrecord_t){};
 667               		.loc 1 110 21 view .LVU140
 668 0134 80E0      		ldi r24,lo8(tapping_key)
 669 0136 90E0      		ldi r25,hi8(tapping_key)
 670 0138 0E94 0000 		call process_record
 671               	.LVL35:
 111:./tmk_core/common/action_tapping.c ****                     debug_tapping_key();
 672               		.loc 1 111 21 view .LVU141
 111:./tmk_core/common/action_tapping.c ****                     debug_tapping_key();
 673               		.loc 1 111 33 is_stmt 0 view .LVU142
 674 013c 86E0      		ldi r24,lo8(6)
 675 013e E0E0      		ldi r30,lo8(tapping_key)
 676 0140 F0E0      		ldi r31,hi8(tapping_key)
 677 0142 DF01      		movw r26,r30
 678               		0:
 679 0144 1D92      		st X+,__zero_reg__
 680 0146 8A95      		dec r24
 681 0148 01F4      		brne 0b
 112:./tmk_core/common/action_tapping.c ****                     // enqueue
 682               		.loc 1 112 21 is_stmt 1 view .LVU143
 683 014a 0E94 0000 		call debug_tapping_key
 684               	.LVL36:
 114:./tmk_core/common/action_tapping.c ****                 }
 685               		.loc 1 114 21 view .LVU144
 686               	.L141:
 114:./tmk_core/common/action_tapping.c ****                 }
 687               		.loc 1 114 21 is_stmt 0 view .LVU145
 688               	.LBE41:
 147:./tmk_core/common/action_tapping.c ****                 }
 689               		.loc 1 147 28 view .LVU146
 690 014e F12C      		mov r15,__zero_reg__
 691 0150 00C0      		rjmp .L35
 692               	.LVL37:
 693               	.L48:
 121:./tmk_core/common/action_tapping.c ****                     // Modifier should be retained till end of this tapping.
 694               		.loc 1 121 22 is_stmt 1 view .LVU147
 695               	.LBB42:
 696               	.LBI42:
 697               		.loc 2 51 20 view .LVU148
 698               	.LBB43:
 699               		.loc 2 51 52 view .LVU149
 700               	.LBB44:
 701               	.LBI44:
  49:./tmk_core/common/keyboard.h **** static inline bool IS_PRESSED(keyevent_t event) { return (!IS_NOEVENT(event) && event.pressed); }
 702               		.loc 2 49 20 view .LVU150
 703               	.LBB45:
  49:./tmk_core/common/keyboard.h **** static inline bool IS_PRESSED(keyevent_t event) { return (!IS_NOEVENT(event) && event.pressed); }
 704               		.loc 2 49 51 view .LVU151
  49:./tmk_core/common/keyboard.h **** static inline bool IS_PRESSED(keyevent_t event) { return (!IS_NOEVENT(event) && event.pressed); }
 705               		.loc 2 49 74 is_stmt 0 view .LVU152
 706 0152 AB28      		or r10,r11
 707 0154 01F0      		breq .L75
  49:./tmk_core/common/keyboard.h **** static inline bool IS_PRESSED(keyevent_t event) { return (!IS_NOEVENT(event) && event.pressed); }
 708               		.loc 2 49 74 view .LVU153
 709 0156 8E2D      		mov r24,r14
 710 0158 8D21      		and r24,r13
 711 015a 8F3F      		cpi r24,lo8(-1)
 712 015c 01F0      		breq .+2
 713 015e 00C0      		rjmp .L50
 714               	.L75:
  49:./tmk_core/common/keyboard.h **** static inline bool IS_PRESSED(keyevent_t event) { return (!IS_NOEVENT(event) && event.pressed); }
 715               		.loc 2 49 74 view .LVU154
 716               	.LBE45:
 717               	.LBE44:
 718               		.loc 2 51 79 view .LVU155
 719 0160 80E0      		ldi r24,0
 720               	.L49:
 721               	.LVL38:
 722               		.loc 2 51 79 view .LVU156
 723               	.LBE43:
 724               	.LBE42:
 121:./tmk_core/common/action_tapping.c ****                     // Modifier should be retained till end of this tapping.
 725               		.loc 1 121 25 view .LVU157
 726 0162 B82F      		mov r27,r24
 727 0164 B170      		andi r27,lo8(1)
 728 0166 BB2E      		mov r11,r27
 729 0168 80FF      		sbrs r24,0
 730 016a 00C0      		rjmp .L51
 121:./tmk_core/common/action_tapping.c ****                     // Modifier should be retained till end of this tapping.
 731               		.loc 1 121 49 discriminator 1 view .LVU158
 732 016c 4C2D      		mov r20,r12
 733 016e 6D2D      		mov r22,r13
 734 0170 8E2D      		mov r24,r14
 735 0172 0E94 0000 		call waiting_buffer_typed.isra.0
 736               	.LVL39:
 737 0176 A82E      		mov r10,r24
 738               	.LVL40:
 121:./tmk_core/common/action_tapping.c ****                     // Modifier should be retained till end of this tapping.
 739               		.loc 1 121 45 discriminator 1 view .LVU159
 740 0178 8111      		cpse r24,__zero_reg__
 741 017a 00C0      		rjmp .L51
 742               	.LBB47:
 123:./tmk_core/common/action_tapping.c ****                     switch (action.kind.id) {
 743               		.loc 1 123 21 is_stmt 1 view .LVU160
 123:./tmk_core/common/action_tapping.c ****                     switch (action.kind.id) {
 744               		.loc 1 123 39 is_stmt 0 view .LVU161
 745 017c EF82      		std Y+7,r14
 746 017e D886      		std Y+8,r13
 747 0180 8F81      		ldd r24,Y+7
 748 0182 9885      		ldd r25,Y+8
 749 0184 0E94 0000 		call layer_switch_get_action
 750               	.LVL41:
 124:./tmk_core/common/action_tapping.c ****                         case ACT_LMODS:
 751               		.loc 1 124 21 is_stmt 1 view .LVU162
 124:./tmk_core/common/action_tapping.c ****                         case ACT_LMODS:
 752               		.loc 1 124 40 is_stmt 0 view .LVU163
 753 0188 292F      		mov r18,r25
 754 018a 2295      		swap r18
 755 018c 2F70      		andi r18,lo8(15)
 124:./tmk_core/common/action_tapping.c ****                         case ACT_LMODS:
 756               		.loc 1 124 21 view .LVU164
 757 018e 9032      		cpi r25,lo8(32)
 758 0190 00F0      		brlo .L52
 124:./tmk_core/common/action_tapping.c ****                         case ACT_LMODS:
 759               		.loc 1 124 21 view .LVU165
 760 0192 225F      		subi r18,lo8(-(14))
 761 0194 2F70      		andi r18,lo8(15)
 762 0196 2230      		cpi r18,lo8(2)
 763 0198 00F0      		brlo .L134
 764               	.LVL42:
 765               	.L53:
 137:./tmk_core/common/action_tapping.c ****                     process_record(keyp);
 766               		.loc 1 137 86 is_stmt 1 view .LVU166
 138:./tmk_core/common/action_tapping.c ****                     return true;
 767               		.loc 1 138 21 view .LVU167
 768 019a C801      		movw r24,r16
 769               	.LVL43:
 138:./tmk_core/common/action_tapping.c ****                     return true;
 770               		.loc 1 138 21 is_stmt 0 view .LVU168
 771 019c 0E94 0000 		call process_record
 772               	.LVL44:
 139:./tmk_core/common/action_tapping.c ****                 }
 773               		.loc 1 139 21 is_stmt 1 view .LVU169
 139:./tmk_core/common/action_tapping.c ****                 }
 774               		.loc 1 139 28 is_stmt 0 view .LVU170
 775 01a0 AB2C      		mov r10,r11
 776 01a2 00C0      		rjmp .L56
 777               	.LVL45:
 778               	.L52:
 127:./tmk_core/common/action_tapping.c ****                             if (IS_MOD(action.key.code)) return false;
 779               		.loc 1 127 29 is_stmt 1 view .LVU171
 127:./tmk_core/common/action_tapping.c ****                             if (IS_MOD(action.key.code)) return false;
 780               		.loc 1 127 33 is_stmt 0 view .LVU172
 781 01a4 9F70      		andi r25,lo8(15)
 782               	.LVL46:
 127:./tmk_core/common/action_tapping.c ****                             if (IS_MOD(action.key.code)) return false;
 783               		.loc 1 127 32 view .LVU173
 784 01a6 01F0      		breq .L57
 127:./tmk_core/common/action_tapping.c ****                             if (IS_MOD(action.key.code)) return false;
 785               		.loc 1 127 49 discriminator 1 view .LVU174
 786 01a8 8823      		tst r24
 787 01aa 01F0      		breq .L56
 788               	.L57:
 133:./tmk_core/common/action_tapping.c ****                             break;
 789               		.loc 1 133 29 is_stmt 1 view .LVU175
 133:./tmk_core/common/action_tapping.c ****                             break;
 790               		.loc 1 133 33 is_stmt 0 view .LVU176
 791 01ac 805E      		subi r24,lo8(-(32))
 792               	.LVL47:
 133:./tmk_core/common/action_tapping.c ****                             break;
 793               		.loc 1 133 32 view .LVU177
 794 01ae 8830      		cpi r24,lo8(8)
 795 01b0 00F0      		brlo .L56
 796 01b2 00C0      		rjmp .L53
 797               	.LVL48:
 798               	.L134:
 132:./tmk_core/common/action_tapping.c ****                             if (IS_MOD(action.key.code)) return false;
 799               		.loc 1 132 29 is_stmt 1 view .LVU178
 132:./tmk_core/common/action_tapping.c ****                             if (IS_MOD(action.key.code)) return false;
 800               		.loc 1 132 33 is_stmt 0 view .LVU179
 801 01b4 9F70      		andi r25,lo8(15)
 802               	.LVL49:
 132:./tmk_core/common/action_tapping.c ****                             if (IS_MOD(action.key.code)) return false;
 803               		.loc 1 132 32 view .LVU180
 804 01b6 01F0      		breq .L57
 132:./tmk_core/common/action_tapping.c ****                             if (IS_MOD(action.key.code)) return false;
 805               		.loc 1 132 68 discriminator 1 view .LVU181
 806 01b8 F801      		movw r30,r16
 807 01ba 9581      		ldd r25,Z+5
 808 01bc 907F      		andi r25,lo8(-16)
 132:./tmk_core/common/action_tapping.c ****                             if (IS_MOD(action.key.code)) return false;
 809               		.loc 1 132 49 discriminator 1 view .LVU182
 810 01be 01F4      		brne .L57
 811               	.LVL50:
 812               	.L56:
 132:./tmk_core/common/action_tapping.c ****                             if (IS_MOD(action.key.code)) return false;
 813               		.loc 1 132 49 discriminator 1 view .LVU183
 814 01c0 FA2C      		mov r15,r10
 815 01c2 00C0      		rjmp .L35
 816               	.LVL51:
 817               	.L51:
 132:./tmk_core/common/action_tapping.c ****                             if (IS_MOD(action.key.code)) return false;
 818               		.loc 1 132 49 discriminator 1 view .LVU184
 819               	.LBE47:
 143:./tmk_core/common/action_tapping.c ****                         tapping_key.tap.interrupted = true;
 820               		.loc 1 143 21 is_stmt 1 view .LVU185
 143:./tmk_core/common/action_tapping.c ****                         tapping_key.tap.interrupted = true;
 821               		.loc 1 143 24 is_stmt 0 view .LVU186
 822 01c4 CC20      		tst r12
 823 01c6 01F4      		brne .+2
 824 01c8 00C0      		rjmp .L35
 144:./tmk_core/common/action_tapping.c ****                     }
 825               		.loc 1 144 25 is_stmt 1 view .LVU187
 144:./tmk_core/common/action_tapping.c ****                     }
 826               		.loc 1 144 53 is_stmt 0 view .LVU188
 827 01ca 8091 0000 		lds r24,tapping_key+5
 828 01ce 8160      		ori r24,lo8(1<<0)
 829 01d0 8093 0000 		sts tapping_key+5,r24
 830 01d4 00C0      		rjmp .L141
 831               	.LVL52:
 832               	.L43:
 152:./tmk_core/common/action_tapping.c ****                     debug("Tapping: Tap release("); debug_dec(tapping_key.tap.count); debug(")\n");
 833               		.loc 1 152 17 is_stmt 1 discriminator 1 view .LVU189
 152:./tmk_core/common/action_tapping.c ****                     debug("Tapping: Tap release("); debug_dec(tapping_key.tap.count); debug(")\n");
 834               		.loc 1 152 21 is_stmt 0 discriminator 1 view .LVU190
 835 01d6 3D11      		cpse r19,r13
 836 01d8 00C0      		rjmp .L58
 152:./tmk_core/common/action_tapping.c ****                     debug("Tapping: Tap release("); debug_dec(tapping_key.tap.count); debug(")\n");
 837               		.loc 1 152 21 discriminator 2 view .LVU191
 838 01da 2E11      		cpse r18,r14
 839 01dc 00C0      		rjmp .L58
 154:./tmk_core/common/action_tapping.c ****                     process_record(keyp);
 840               		.loc 1 154 31 discriminator 3 view .LVU192
 841 01de D801      		movw r26,r16
 152:./tmk_core/common/action_tapping.c ****                     debug("Tapping: Tap release("); debug_dec(tapping_key.tap.count); debug(")\n");
 842               		.loc 1 152 47 discriminator 3 view .LVU193
 843 01e0 CC20      		tst r12
 844 01e2 01F4      		brne .+2
 845 01e4 00C0      		rjmp .L147
 846               	.L58:
 160:./tmk_core/common/action_tapping.c ****                     if (tapping_key.tap.count > 1) {
 847               		.loc 1 160 22 is_stmt 1 view .LVU194
 160:./tmk_core/common/action_tapping.c ****                     if (tapping_key.tap.count > 1) {
 848               		.loc 1 160 26 is_stmt 0 view .LVU195
 849 01e6 EF82      		std Y+7,r14
 850 01e8 D886      		std Y+8,r13
 851 01ea 8F81      		ldd r24,Y+7
 852 01ec 9885      		ldd r25,Y+8
 853 01ee 0E94 0000 		call is_tap_key
 854               	.LVL53:
 160:./tmk_core/common/action_tapping.c ****                     if (tapping_key.tap.count > 1) {
 855               		.loc 1 160 25 view .LVU196
 856 01f2 8823      		tst r24
 857 01f4 01F0      		breq .L70
 160:./tmk_core/common/action_tapping.c ****                     if (tapping_key.tap.count > 1) {
 858               		.loc 1 160 48 discriminator 1 view .LVU197
 859 01f6 CC20      		tst r12
 860 01f8 01F0      		breq .L70
 161:./tmk_core/common/action_tapping.c ****                         debug("Tapping: Start new tap with releasing last tap(>1).\n");
 861               		.loc 1 161 21 is_stmt 1 view .LVU198
 161:./tmk_core/common/action_tapping.c ****                         debug("Tapping: Start new tap with releasing last tap(>1).\n");
 862               		.loc 1 161 40 is_stmt 0 view .LVU199
 863 01fa 8091 0000 		lds r24,tapping_key+5
 161:./tmk_core/common/action_tapping.c ****                         debug("Tapping: Start new tap with releasing last tap(>1).\n");
 864               		.loc 1 161 24 view .LVU200
 865 01fe 8032      		cpi r24,lo8(32)
 866 0200 00F0      		brlo .L61
 867               	.LBB48:
 162:./tmk_core/common/action_tapping.c ****                         // unregister key
 868               		.loc 1 162 87 is_stmt 1 view .LVU201
 164:./tmk_core/common/action_tapping.c ****                                 .tap = tapping_key.tap,
 869               		.loc 1 164 25 view .LVU202
 164:./tmk_core/common/action_tapping.c ****                                 .tap = tapping_key.tap,
 870               		.loc 1 164 54 is_stmt 0 view .LVU203
 871 0202 2091 0000 		lds r18,tapping_key
 872 0206 3091 0000 		lds r19,tapping_key+1
 873 020a 3A83      		std Y+2,r19
 874 020c 2983      		std Y+1,r18
 875 020e 1B82      		std Y+3,__zero_reg__
 876 0210 BD82      		std Y+5,r11
 877 0212 AC82      		std Y+4,r10
 878 0214 8E83      		std Y+6,r24
 164:./tmk_core/common/action_tapping.c ****                                 .tap = tapping_key.tap,
 879               		.loc 1 164 25 view .LVU204
 880 0216 CE01      		movw r24,r28
 881 0218 0196      		adiw r24,1
 882 021a 0E94 0000 		call process_record
 883               	.LVL54:
 884               	.L61:
 164:./tmk_core/common/action_tapping.c ****                                 .tap = tapping_key.tap,
 885               		.loc 1 164 25 view .LVU205
 886               	.LBE48:
 171:./tmk_core/common/action_tapping.c ****                     }
 887               		.loc 1 171 69 is_stmt 1 view .LVU206
 173:./tmk_core/common/action_tapping.c ****                     waiting_buffer_scan_tap();
 888               		.loc 1 173 21 view .LVU207
 173:./tmk_core/common/action_tapping.c ****                     waiting_buffer_scan_tap();
 889               		.loc 1 173 33 is_stmt 0 view .LVU208
 890 021e 86E0      		ldi r24,lo8(6)
 891 0220 F801      		movw r30,r16
 892 0222 A0E0      		ldi r26,lo8(tapping_key)
 893 0224 B0E0      		ldi r27,hi8(tapping_key)
 894               		0:
 895 0226 0190      		ld r0,Z+
 896 0228 0D92      		st X+,r0
 897 022a 8A95      		dec r24
 898 022c 01F4      		brne 0b
 174:./tmk_core/common/action_tapping.c ****                     debug_tapping_key();
 899               		.loc 1 174 21 is_stmt 1 view .LVU209
 900 022e 0E94 0000 		call waiting_buffer_scan_tap
 901               	.LVL55:
 175:./tmk_core/common/action_tapping.c ****                     return true;
 902               		.loc 1 175 21 view .LVU210
 903 0232 0E94 0000 		call debug_tapping_key
 904               	.LVL56:
 176:./tmk_core/common/action_tapping.c ****                 }
 905               		.loc 1 176 21 view .LVU211
 906               	.L142:
 183:./tmk_core/common/action_tapping.c ****                 }
 907               		.loc 1 183 21 view .LVU212
 183:./tmk_core/common/action_tapping.c ****                 }
 908               		.loc 1 183 28 is_stmt 0 view .LVU213
 909 0236 FF24      		clr r15
 910 0238 F394      		inc r15
 911 023a 00C0      		rjmp .L35
 912               	.L70:
 179:./tmk_core/common/action_tapping.c ****                         debug("Tapping: key event while last tap(>0).\n");
 913               		.loc 1 179 21 is_stmt 1 view .LVU214
 180:./tmk_core/common/action_tapping.c ****                     }
 914               		.loc 1 180 74 view .LVU215
 182:./tmk_core/common/action_tapping.c ****                     return true;
 915               		.loc 1 182 21 view .LVU216
 916 023c C801      		movw r24,r16
 917 023e 0E94 0000 		call process_record
 918               	.LVL57:
 919 0242 00C0      		rjmp .L142
 920               	.LVL58:
 921               	.L42:
 189:./tmk_core/common/action_tapping.c ****                 debug("Tapping: End. Timeout. Not tap(0): ");
 922               		.loc 1 189 13 view .LVU217
 189:./tmk_core/common/action_tapping.c ****                 debug("Tapping: End. Timeout. Not tap(0): ");
 923               		.loc 1 189 16 is_stmt 0 view .LVU218
 924 0244 9111      		cpse r25,__zero_reg__
 925 0246 00C0      		rjmp .L62
 926               	.LBB49:
 190:./tmk_core/common/action_tapping.c ****                 debug_event(event); debug("\n");
 927               		.loc 1 190 61 is_stmt 1 view .LVU219
 191:./tmk_core/common/action_tapping.c ****                 process_record(&tapping_key);
 928               		.loc 1 191 17 view .LVU220
 191:./tmk_core/common/action_tapping.c ****                 process_record(&tapping_key);
 929               		.loc 1 191 17 is_stmt 0 view .LVU221
 930 0248 7A2D      		mov r23,r10
 931 024a BB86      		std Y+11,r11
 932 024c AA86      		std Y+10,r10
 933 024e 4E2D      		mov r20,r14
 934 0250 5D2D      		mov r21,r13
 935 0252 6C2D      		mov r22,r12
 936 0254 8B85      		ldd r24,Y+11
 937 0256 0E94 0000 		call debug_event
 938               	.LVL59:
 191:./tmk_core/common/action_tapping.c ****                 process_record(&tapping_key);
 939               		.loc 1 191 48 is_stmt 1 view .LVU222
 192:./tmk_core/common/action_tapping.c ****                 tapping_key = (keyrecord_t){};
 940               		.loc 1 192 17 view .LVU223
 941 025a 80E0      		ldi r24,lo8(tapping_key)
 942 025c 90E0      		ldi r25,hi8(tapping_key)
 943 025e 0E94 0000 		call process_record
 944               	.LVL60:
 193:./tmk_core/common/action_tapping.c ****                 debug_tapping_key();
 945               		.loc 1 193 17 view .LVU224
 193:./tmk_core/common/action_tapping.c ****                 debug_tapping_key();
 946               		.loc 1 193 29 is_stmt 0 view .LVU225
 947 0262 86E0      		ldi r24,lo8(6)
 948 0264 F401      		movw r30,r8
 949               		0:
 950 0266 1192      		st Z+,__zero_reg__
 951 0268 8A95      		dec r24
 952 026a 01F4      		brne 0b
 194:./tmk_core/common/action_tapping.c ****                 return false;
 953               		.loc 1 194 17 is_stmt 1 view .LVU226
 954               	.LVL61:
 955               	.L140:
 194:./tmk_core/common/action_tapping.c ****                 return false;
 956               		.loc 1 194 17 is_stmt 0 view .LVU227
 957               	.LBE49:
 286:./tmk_core/common/action_tapping.c ****             return true;
 958               		.loc 1 286 13 is_stmt 1 view .LVU228
 959 026c 0E94 0000 		call debug_tapping_key
 960               	.LVL62:
 287:./tmk_core/common/action_tapping.c ****         } else {
 961               		.loc 1 287 13 view .LVU229
 287:./tmk_core/common/action_tapping.c ****         } else {
 962               		.loc 1 287 20 is_stmt 0 view .LVU230
 963 0270 00C0      		rjmp .L35
 964               	.LVL63:
 965               	.L62:
 197:./tmk_core/common/action_tapping.c ****                     debug("Tapping: End. last timeout tap release(>0).");
 966               		.loc 1 197 17 is_stmt 1 discriminator 1 view .LVU231
 197:./tmk_core/common/action_tapping.c ****                     debug("Tapping: End. last timeout tap release(>0).");
 967               		.loc 1 197 21 is_stmt 0 discriminator 1 view .LVU232
 968 0272 3D11      		cpse r19,r13
 969 0274 00C0      		rjmp .L58
 197:./tmk_core/common/action_tapping.c ****                     debug("Tapping: End. last timeout tap release(>0).");
 970               		.loc 1 197 21 discriminator 2 view .LVU233
 971 0276 2E11      		cpse r18,r14
 972 0278 00C0      		rjmp .L58
 197:./tmk_core/common/action_tapping.c ****                     debug("Tapping: End. last timeout tap release(>0).");
 973               		.loc 1 197 47 discriminator 3 view .LVU234
 974 027a C110      		cpse r12,__zero_reg__
 975 027c 00C0      		rjmp .L58
 976               	.LBB50:
 198:./tmk_core/common/action_tapping.c ****                     keyp->tap = tapping_key.tap;
 977               		.loc 1 198 73 is_stmt 1 view .LVU235
 199:./tmk_core/common/action_tapping.c ****                     process_record(keyp);
 978               		.loc 1 199 21 view .LVU236
 199:./tmk_core/common/action_tapping.c ****                     process_record(keyp);
 979               		.loc 1 199 31 is_stmt 0 view .LVU237
 980 027e D801      		movw r26,r16
 981 0280 1596      		adiw r26,5
 982 0282 8C93      		st X,r24
 200:./tmk_core/common/action_tapping.c ****                     tapping_key = (keyrecord_t){};
 983               		.loc 1 200 21 is_stmt 1 view .LVU238
 984 0284 C801      		movw r24,r16
 985 0286 0E94 0000 		call process_record
 986               	.LVL64:
 201:./tmk_core/common/action_tapping.c ****                     return true;
 987               		.loc 1 201 21 view .LVU239
 201:./tmk_core/common/action_tapping.c ****                     return true;
 988               		.loc 1 201 33 is_stmt 0 view .LVU240
 989 028a 86E0      		ldi r24,lo8(6)
 990 028c F401      		movw r30,r8
 991               		0:
 992 028e 1192      		st Z+,__zero_reg__
 993 0290 8A95      		dec r24
 994 0292 01F4      		brne 0b
 202:./tmk_core/common/action_tapping.c ****                 }
 995               		.loc 1 202 21 is_stmt 1 view .LVU241
 202:./tmk_core/common/action_tapping.c ****                 }
 996               		.loc 1 202 28 is_stmt 0 view .LVU242
 997 0294 F72C      		mov r15,r7
 998 0296 00C0      		rjmp .L35
 999               	.L37:
 202:./tmk_core/common/action_tapping.c ****                 }
 1000               		.loc 1 202 28 view .LVU243
 1001               	.LBE50:
 231:./tmk_core/common/action_tapping.c ****         if (WITHIN_TAPPING_TERM(event)) {
 1002               		.loc 1 231 12 is_stmt 1 discriminator 1 view .LVU244
 232:./tmk_core/common/action_tapping.c ****             if (event.pressed) {
 1003               		.loc 1 232 9 discriminator 1 view .LVU245
 232:./tmk_core/common/action_tapping.c ****             if (event.pressed) {
 1004               		.loc 1 232 13 is_stmt 0 discriminator 1 view .LVU246
 1005 0298 A816      		cp r10,r24
 1006 029a B906      		cpc r11,r25
 1007 029c 00F0      		brlo .L65
 1008 029e A501      		movw r20,r10
 1009 02a0 481B      		sub r20,r24
 1010 02a2 590B      		sbc r21,r25
 1011 02a4 CA01      		movw r24,r20
 1012               	.L146:
 232:./tmk_core/common/action_tapping.c ****             if (event.pressed) {
 1013               		.loc 1 232 13 discriminator 2 view .LVU247
 1014 02a6 F12C      		mov r15,__zero_reg__
 1015 02a8 8639      		cpi r24,-106
 1016 02aa 9105      		cpc r25,__zero_reg__
 1017 02ac 00F0      		brlo .+2
 1018 02ae 00C0      		rjmp .L69
 233:./tmk_core/common/action_tapping.c ****                 if (IS_TAPPING_KEY(event.key)) {
 1019               		.loc 1 233 13 is_stmt 1 view .LVU248
 233:./tmk_core/common/action_tapping.c ****                 if (IS_TAPPING_KEY(event.key)) {
 1020               		.loc 1 233 22 is_stmt 0 view .LVU249
 1021 02b0 FC2C      		mov r15,r12
 233:./tmk_core/common/action_tapping.c ****                 if (IS_TAPPING_KEY(event.key)) {
 1022               		.loc 1 233 16 view .LVU250
 1023 02b2 CC20      		tst r12
 1024 02b4 01F4      		brne .+2
 1025 02b6 00C0      		rjmp .L70
 234:./tmk_core/common/action_tapping.c **** #ifndef TAPPING_FORCE_HOLD
 1026               		.loc 1 234 17 is_stmt 1 discriminator 1 view .LVU251
 234:./tmk_core/common/action_tapping.c **** #ifndef TAPPING_FORCE_HOLD
 1027               		.loc 1 234 21 is_stmt 0 discriminator 1 view .LVU252
 1028 02b8 3D11      		cpse r19,r13
 1029 02ba 00C0      		rjmp .L71
 234:./tmk_core/common/action_tapping.c **** #ifndef TAPPING_FORCE_HOLD
 1030               		.loc 1 234 21 discriminator 2 view .LVU253
 1031 02bc 2E11      		cpse r18,r14
 1032 02be 00C0      		rjmp .L71
 236:./tmk_core/common/action_tapping.c ****                         // sequential tap.
 1033               		.loc 1 236 21 is_stmt 1 view .LVU254
 236:./tmk_core/common/action_tapping.c ****                         // sequential tap.
 1034               		.loc 1 236 41 is_stmt 0 view .LVU255
 1035 02c0 8091 0000 		lds r24,tapping_key+5
 236:./tmk_core/common/action_tapping.c ****                         // sequential tap.
 1036               		.loc 1 236 24 view .LVU256
 1037 02c4 80FD      		sbrc r24,0
 1038 02c6 00C0      		rjmp .L72
 236:./tmk_core/common/action_tapping.c ****                         // sequential tap.
 1039               		.loc 1 236 79 discriminator 1 view .LVU257
 1040 02c8 982F      		mov r25,r24
 1041 02ca 907F      		andi r25,lo8(-16)
 236:./tmk_core/common/action_tapping.c ****                         // sequential tap.
 1042               		.loc 1 236 54 discriminator 1 view .LVU258
 1043 02cc 01F0      		breq .L72
 238:./tmk_core/common/action_tapping.c ****                         if (keyp->tap.count < 15) keyp->tap.count += 1;
 1044               		.loc 1 238 25 is_stmt 1 view .LVU259
 238:./tmk_core/common/action_tapping.c ****                         if (keyp->tap.count < 15) keyp->tap.count += 1;
 1045               		.loc 1 238 35 is_stmt 0 view .LVU260
 1046 02ce D801      		movw r26,r16
 1047 02d0 1596      		adiw r26,5
 1048 02d2 8C93      		st X,r24
 1049 02d4 1597      		sbiw r26,5
 239:./tmk_core/common/action_tapping.c ****                         debug("Tapping: Tap press("); debug_dec(keyp->tap.count); debug(")\n");
 1050               		.loc 1 239 25 is_stmt 1 view .LVU261
 239:./tmk_core/common/action_tapping.c ****                         debug("Tapping: Tap press("); debug_dec(keyp->tap.count); debug(")\n");
 1051               		.loc 1 239 28 is_stmt 0 view .LVU262
 1052 02d6 903F      		cpi r25,lo8(-16)
 1053 02d8 01F0      		breq .L73
 239:./tmk_core/common/action_tapping.c ****                         debug("Tapping: Tap press("); debug_dec(keyp->tap.count); debug(")\n");
 1054               		.loc 1 239 51 is_stmt 1 discriminator 1 view .LVU263
 239:./tmk_core/common/action_tapping.c ****                         debug("Tapping: Tap press("); debug_dec(keyp->tap.count); debug(")\n");
 1055               		.loc 1 239 67 is_stmt 0 discriminator 1 view .LVU264
 1056 02da 982F      		mov r25,r24
 1057 02dc 907F      		andi r25,lo8(-16)
 1058 02de 905F      		subi r25,lo8(-(16))
 1059 02e0 8F70      		andi r24,lo8(15)
 1060 02e2 892B      		or r24,r25
 1061               	.L147:
 239:./tmk_core/common/action_tapping.c ****                         debug("Tapping: Tap press("); debug_dec(keyp->tap.count); debug(")\n");
 1062               		.loc 1 239 67 discriminator 1 view .LVU265
 1063 02e4 1596      		adiw r26,5
 1064 02e6 8C93      		st X,r24
 1065               	.L73:
 240:./tmk_core/common/action_tapping.c ****                         process_record(keyp);
 1066               		.loc 1 240 53 is_stmt 1 view .LVU266
 240:./tmk_core/common/action_tapping.c ****                         process_record(keyp);
 1067               		.loc 1 240 81 view .LVU267
 240:./tmk_core/common/action_tapping.c ****                         process_record(keyp);
 1068               		.loc 1 240 95 view .LVU268
 241:./tmk_core/common/action_tapping.c ****                         tapping_key = *keyp;
 1069               		.loc 1 241 25 view .LVU269
 1070 02e8 C801      		movw r24,r16
 1071 02ea 0E94 0000 		call process_record
 1072               	.LVL65:
 242:./tmk_core/common/action_tapping.c ****                         debug_tapping_key();
 1073               		.loc 1 242 25 view .LVU270
 242:./tmk_core/common/action_tapping.c ****                         debug_tapping_key();
 1074               		.loc 1 242 37 is_stmt 0 view .LVU271
 1075 02ee 86E0      		ldi r24,lo8(6)
 1076 02f0 F801      		movw r30,r16
 1077 02f2 A0E0      		ldi r26,lo8(tapping_key)
 1078 02f4 B0E0      		ldi r27,hi8(tapping_key)
 1079               		0:
 1080 02f6 0190      		ld r0,Z+
 1081 02f8 0D92      		st X+,r0
 1082 02fa 8A95      		dec r24
 1083 02fc 01F4      		brne 0b
 243:./tmk_core/common/action_tapping.c ****                         return true;
 1084               		.loc 1 243 25 is_stmt 1 view .LVU272
 1085 02fe 00C0      		rjmp .L140
 1086               	.L65:
 232:./tmk_core/common/action_tapping.c ****             if (event.pressed) {
 1087               		.loc 1 232 13 is_stmt 0 discriminator 2 view .LVU273
 1088 0300 8095      		com r24
 1089 0302 9095      		com r25
 1090 0304 8A0D      		add r24,r10
 1091 0306 9B1D      		adc r25,r11
 1092 0308 00C0      		rjmp .L146
 1093               	.L72:
 248:./tmk_core/common/action_tapping.c ****                     return true;
 1094               		.loc 1 248 21 is_stmt 1 view .LVU274
 248:./tmk_core/common/action_tapping.c ****                     return true;
 1095               		.loc 1 248 33 is_stmt 0 view .LVU275
 1096 030a 86E0      		ldi r24,lo8(6)
 1097 030c F801      		movw r30,r16
 1098 030e A0E0      		ldi r26,lo8(tapping_key)
 1099 0310 B0E0      		ldi r27,hi8(tapping_key)
 1100               		0:
 1101 0312 0190      		ld r0,Z+
 1102 0314 0D92      		st X+,r0
 1103 0316 8A95      		dec r24
 1104 0318 01F4      		brne 0b
 249:./tmk_core/common/action_tapping.c ****                 } else if (is_tap_key(event.key)) {
 1105               		.loc 1 249 21 is_stmt 1 view .LVU276
 249:./tmk_core/common/action_tapping.c ****                 } else if (is_tap_key(event.key)) {
 1106               		.loc 1 249 28 is_stmt 0 view .LVU277
 1107 031a 00C0      		rjmp .L35
 1108               	.L71:
 250:./tmk_core/common/action_tapping.c ****                     // Sequential tap can be interfered with other tap key.
 1109               		.loc 1 250 24 is_stmt 1 view .LVU278
 250:./tmk_core/common/action_tapping.c ****                     // Sequential tap can be interfered with other tap key.
 1110               		.loc 1 250 28 is_stmt 0 view .LVU279
 1111 031c EF82      		std Y+7,r14
 1112 031e D886      		std Y+8,r13
 1113 0320 8F81      		ldd r24,Y+7
 1114 0322 9885      		ldd r25,Y+8
 1115 0324 0E94 0000 		call is_tap_key
 1116               	.LVL66:
 250:./tmk_core/common/action_tapping.c ****                     // Sequential tap can be interfered with other tap key.
 1117               		.loc 1 250 27 view .LVU280
 1118 0328 8111      		cpse r24,__zero_reg__
 1119 032a 00C0      		rjmp .L61
 260:./tmk_core/common/action_tapping.c ****                     process_record(keyp);
 1120               		.loc 1 260 21 is_stmt 1 view .LVU281
 260:./tmk_core/common/action_tapping.c ****                     process_record(keyp);
 1121               		.loc 1 260 49 is_stmt 0 view .LVU282
 1122 032c 8091 0000 		lds r24,tapping_key+5
 1123 0330 8160      		ori r24,lo8(1<<0)
 1124 0332 8093 0000 		sts tapping_key+5,r24
 261:./tmk_core/common/action_tapping.c ****                     return true;
 1125               		.loc 1 261 21 is_stmt 1 view .LVU283
 1126 0336 C801      		movw r24,r16
 1127 0338 0E94 0000 		call process_record
 1128               	.LVL67:
 262:./tmk_core/common/action_tapping.c ****                 }
 1129               		.loc 1 262 21 view .LVU284
 262:./tmk_core/common/action_tapping.c ****                 }
 1130               		.loc 1 262 28 is_stmt 0 view .LVU285
 1131 033c 00C0      		rjmp .L35
 1132               	.L69:
 1133               	.LBB51:
 272:./tmk_core/common/action_tapping.c ****             debug_event(event); debug("\n");
 1134               		.loc 1 272 70 is_stmt 1 view .LVU286
 273:./tmk_core/common/action_tapping.c ****             tapping_key = (keyrecord_t){};
 1135               		.loc 1 273 13 view .LVU287
 273:./tmk_core/common/action_tapping.c ****             tapping_key = (keyrecord_t){};
 1136               		.loc 1 273 13 is_stmt 0 view .LVU288
 1137 033e 7A2D      		mov r23,r10
 1138 0340 BB86      		std Y+11,r11
 1139 0342 AA86      		std Y+10,r10
 1140 0344 4E2D      		mov r20,r14
 1141 0346 5D2D      		mov r21,r13
 1142 0348 6C2D      		mov r22,r12
 1143 034a 8B85      		ldd r24,Y+11
 1144 034c 0E94 0000 		call debug_event
 1145               	.LVL68:
 273:./tmk_core/common/action_tapping.c ****             tapping_key = (keyrecord_t){};
 1146               		.loc 1 273 44 is_stmt 1 view .LVU289
 274:./tmk_core/common/action_tapping.c ****             debug_tapping_key();
 1147               		.loc 1 274 13 view .LVU290
 274:./tmk_core/common/action_tapping.c ****             debug_tapping_key();
 1148               		.loc 1 274 25 is_stmt 0 view .LVU291
 1149 0350 86E0      		ldi r24,lo8(6)
 1150 0352 E0E0      		ldi r30,lo8(tapping_key)
 1151 0354 F0E0      		ldi r31,hi8(tapping_key)
 1152 0356 DF01      		movw r26,r30
 1153               		0:
 1154 0358 1D92      		st X+,__zero_reg__
 1155 035a 8A95      		dec r24
 1156 035c 01F4      		brne 0b
 275:./tmk_core/common/action_tapping.c ****             return false;
 1157               		.loc 1 275 13 is_stmt 1 view .LVU292
 1158 035e 00C0      		rjmp .L140
 1159               	.LVL69:
 1160               	.L36:
 275:./tmk_core/common/action_tapping.c ****             return false;
 1161               		.loc 1 275 13 is_stmt 0 view .LVU293
 1162               	.LBE51:
 281:./tmk_core/common/action_tapping.c ****             debug("Tapping: Start(Press tap key).\n");
 1163               		.loc 1 281 9 is_stmt 1 view .LVU294
 281:./tmk_core/common/action_tapping.c ****             debug("Tapping: Start(Press tap key).\n");
 1164               		.loc 1 281 12 is_stmt 0 view .LVU295
 1165 0360 CC20      		tst r12
 1166 0362 01F4      		brne .+2
 1167 0364 00C0      		rjmp .L70
 281:./tmk_core/common/action_tapping.c ****             debug("Tapping: Start(Press tap key).\n");
 1168               		.loc 1 281 30 discriminator 1 view .LVU296
 1169 0366 EF82      		std Y+7,r14
 1170 0368 D886      		std Y+8,r13
 1171 036a 8F81      		ldd r24,Y+7
 1172 036c 9885      		ldd r25,Y+8
 1173 036e 0E94 0000 		call is_tap_key
 1174               	.LVL70:
 281:./tmk_core/common/action_tapping.c ****             debug("Tapping: Start(Press tap key).\n");
 1175               		.loc 1 281 30 discriminator 1 view .LVU297
 1176 0372 F82E      		mov r15,r24
 281:./tmk_core/common/action_tapping.c ****             debug("Tapping: Start(Press tap key).\n");
 1177               		.loc 1 281 27 discriminator 1 view .LVU298
 1178 0374 8823      		tst r24
 1179 0376 01F4      		brne .+2
 1180 0378 00C0      		rjmp .L70
 282:./tmk_core/common/action_tapping.c ****             tapping_key = *keyp;
 1181               		.loc 1 282 54 is_stmt 1 view .LVU299
 283:./tmk_core/common/action_tapping.c ****             process_record_tap_hint(&tapping_key);
 1182               		.loc 1 283 13 view .LVU300
 283:./tmk_core/common/action_tapping.c ****             process_record_tap_hint(&tapping_key);
 1183               		.loc 1 283 25 is_stmt 0 view .LVU301
 1184 037a 86E0      		ldi r24,lo8(6)
 1185 037c F801      		movw r30,r16
 1186 037e A0E0      		ldi r26,lo8(tapping_key)
 1187 0380 B0E0      		ldi r27,hi8(tapping_key)
 1188               		0:
 1189 0382 0190      		ld r0,Z+
 1190 0384 0D92      		st X+,r0
 1191 0386 8A95      		dec r24
 1192 0388 01F4      		brne 0b
 284:./tmk_core/common/action_tapping.c ****             waiting_buffer_scan_tap();
 1193               		.loc 1 284 13 is_stmt 1 view .LVU302
 1194 038a 80E0      		ldi r24,lo8(tapping_key)
 1195 038c 90E0      		ldi r25,hi8(tapping_key)
 1196 038e 0E94 0000 		call process_record_tap_hint
 1197               	.LVL71:
 285:./tmk_core/common/action_tapping.c ****             debug_tapping_key();
 1198               		.loc 1 285 13 view .LVU303
 1199 0392 0E94 0000 		call waiting_buffer_scan_tap
 1200               	.LVL72:
 1201 0396 00C0      		rjmp .L140
 1202               	.LVL73:
 1203               	.L50:
 1204               	.LBB52:
 1205               	.LBB46:
 1206               		.loc 2 51 79 is_stmt 0 view .LVU304
 1207 0398 81E0      		ldi r24,lo8(1)
 1208 039a 8C25      		eor r24,r12
 1209 039c 00C0      		rjmp .L49
 1210               	.LVL74:
 1211               	.L47:
 1212               		.loc 2 51 79 view .LVU305
 1213               	.LBE46:
 1214               	.LBE52:
 1215               	.LBB53:
 1216               	.LBB40:
 1217 039e 81E0      		ldi r24,lo8(1)
 1218 03a0 8C25      		eor r24,r12
 1219 03a2 00C0      		rjmp .L46
 1220               	.LBE40:
 1221               	.LBE53:
 1222               		.cfi_endproc
 1223               	.LFE5:
 1225               		.section	.text.action_tapping_process,"ax",@progbits
 1226               	.global	action_tapping_process
 1228               	action_tapping_process:
 1229               	.LFB4:
  44:./tmk_core/common/action_tapping.c ****     if (process_tapping(&record)) {
 1230               		.loc 1 44 1 is_stmt 1 view -0
 1231               		.cfi_startproc
 1232 0000 1F93      		push r17
 1233               	.LCFI21:
 1234               		.cfi_def_cfa_offset 3
 1235               		.cfi_offset 17, -2
 1236 0002 CF93      		push r28
 1237               	.LCFI22:
 1238               		.cfi_def_cfa_offset 4
 1239               		.cfi_offset 28, -3
 1240 0004 DF93      		push r29
 1241               	.LCFI23:
 1242               		.cfi_def_cfa_offset 5
 1243               		.cfi_offset 29, -4
 1244 0006 CDB7      		in r28,__SP_L__
 1245 0008 DEB7      		in r29,__SP_H__
 1246               	.LCFI24:
 1247               		.cfi_def_cfa_register 28
 1248 000a 2C97      		sbiw r28,12
 1249               	.LCFI25:
 1250               		.cfi_def_cfa_offset 17
 1251 000c 0FB6      		in __tmp_reg__,__SREG__
 1252 000e F894      		cli
 1253 0010 DEBF      		out __SP_H__,r29
 1254 0012 0FBE      		out __SREG__,__tmp_reg__
 1255 0014 CDBF      		out __SP_L__,r28
 1256               	/* prologue: function */
 1257               	/* frame size = 12 */
 1258               	/* stack size = 15 */
 1259               	.L__stack_usage = 15
 1260 0016 4F83      		std Y+7,r20
 1261 0018 5887      		std Y+8,r21
 1262 001a 6987      		std Y+9,r22
 1263 001c 7A87      		std Y+10,r23
 1264 001e 8B87      		std Y+11,r24
 1265 0020 9C87      		std Y+12,r25
  45:./tmk_core/common/action_tapping.c ****         if (!IS_NOEVENT(record.event)) {
 1266               		.loc 1 45 5 view .LVU307
  45:./tmk_core/common/action_tapping.c ****         if (!IS_NOEVENT(record.event)) {
 1267               		.loc 1 45 9 is_stmt 0 view .LVU308
 1268 0022 CE01      		movw r24,r28
 1269 0024 0796      		adiw r24,7
 1270 0026 0E94 0000 		call process_tapping
 1271               	.LVL75:
  45:./tmk_core/common/action_tapping.c ****         if (!IS_NOEVENT(record.event)) {
 1272               		.loc 1 45 8 view .LVU309
 1273 002a 8823      		tst r24
 1274 002c 01F0      		breq .L152
  46:./tmk_core/common/action_tapping.c ****             debug("processed: "); debug_record(record); debug("\n");
 1275               		.loc 1 46 9 is_stmt 1 view .LVU310
 1276               	.LBB63:
 1277               	.LBI63:
  49:./tmk_core/common/keyboard.h **** static inline bool IS_PRESSED(keyevent_t event) { return (!IS_NOEVENT(event) && event.pressed); }
 1278               		.loc 2 49 20 view .LVU311
 1279               	.LBB64:
  49:./tmk_core/common/keyboard.h **** static inline bool IS_PRESSED(keyevent_t event) { return (!IS_NOEVENT(event) && event.pressed); }
 1280               		.loc 2 49 51 view .LVU312
  49:./tmk_core/common/keyboard.h **** static inline bool IS_PRESSED(keyevent_t event) { return (!IS_NOEVENT(event) && event.pressed); }
 1281               		.loc 2 49 74 is_stmt 0 view .LVU313
 1282 002e 8A85      		ldd r24,Y+10
 1283 0030 9B85      		ldd r25,Y+11
 1284 0032 892B      		or r24,r25
 1285 0034 01F0      		breq .L153
 1286 0036 4F81      		ldd r20,Y+7
 1287 0038 5885      		ldd r21,Y+8
 1288 003a 842F      		mov r24,r20
 1289 003c 8523      		and r24,r21
 1290 003e 8F3F      		cpi r24,lo8(-1)
 1291 0040 01F0      		breq .+2
 1292 0042 00C0      		rjmp .L175
 1293               	.L153:
 1294               	.LBE64:
 1295               	.LBE63:
  64:./tmk_core/common/action_tapping.c ****             debug("processed: waiting_buffer["); debug_dec(waiting_buffer_tail); debug("] = ");
 1296               		.loc 1 64 13 discriminator 1 view .LVU314
 1297 0044 16E0      		ldi r17,lo8(6)
 1298 0046 00C0      		rjmp .L160
 1299               	.L152:
  50:./tmk_core/common/action_tapping.c ****             // clear all in case of overflow.
 1300               		.loc 1 50 9 is_stmt 1 view .LVU315
 1301 0048 86E0      		ldi r24,lo8(6)
 1302 004a FE01      		movw r30,r28
 1303 004c 3796      		adiw r30,7
 1304 004e DE01      		movw r26,r28
 1305 0050 1196      		adiw r26,1
 1306               		0:
 1307 0052 0190      		ld r0,Z+
 1308 0054 0D92      		st X+,r0
 1309 0056 8A95      		dec r24
 1310 0058 01F4      		brne 0b
 1311               	.LVL76:
  50:./tmk_core/common/action_tapping.c ****             // clear all in case of overflow.
 1312               		.loc 1 50 9 is_stmt 0 view .LVU316
 1313 005a 6A85      		ldd r22,Y+10
 1314 005c 7B85      		ldd r23,Y+11
 1315               	.LVL77:
 1316               	.LBB65:
 1317               	.LBI65:
 300:./tmk_core/common/action_tapping.c **** {
 1318               		.loc 1 300 6 is_stmt 1 view .LVU317
 1319               	.LBB66:
 302:./tmk_core/common/action_tapping.c ****         return true;
 1320               		.loc 1 302 5 view .LVU318
 1321               	.LBB67:
 1322               	.LBI67:
  49:./tmk_core/common/keyboard.h **** static inline bool IS_PRESSED(keyevent_t event) { return (!IS_NOEVENT(event) && event.pressed); }
 1323               		.loc 2 49 20 view .LVU319
 1324               	.LBB68:
  49:./tmk_core/common/keyboard.h **** static inline bool IS_PRESSED(keyevent_t event) { return (!IS_NOEVENT(event) && event.pressed); }
 1325               		.loc 2 49 51 view .LVU320
  49:./tmk_core/common/keyboard.h **** static inline bool IS_PRESSED(keyevent_t event) { return (!IS_NOEVENT(event) && event.pressed); }
 1326               		.loc 2 49 74 is_stmt 0 view .LVU321
 1327 005e 6115      		cp r22,__zero_reg__
 1328 0060 7105      		cpc r23,__zero_reg__
 1329 0062 01F0      		breq .L153
 1330 0064 5F81      		ldd r21,Y+7
 1331 0066 4885      		ldd r20,Y+8
 1332 0068 842F      		mov r24,r20
 1333 006a 8523      		and r24,r21
 1334 006c 8F3F      		cpi r24,lo8(-1)
 1335 006e 01F0      		breq .L153
 1336               	.LBE68:
 1337               	.LBE67:
 306:./tmk_core/common/action_tapping.c ****         debug("waiting_buffer_enq: Over flow.\n");
 1338               		.loc 1 306 5 is_stmt 1 view .LVU322
 306:./tmk_core/common/action_tapping.c ****         debug("waiting_buffer_enq: Over flow.\n");
 1339               		.loc 1 306 30 is_stmt 0 view .LVU323
 1340 0070 2091 0000 		lds r18,waiting_buffer_head
 1341 0074 30E0      		ldi r19,0
 1342 0076 C901      		movw r24,r18
 1343 0078 0196      		adiw r24,1
 306:./tmk_core/common/action_tapping.c ****         debug("waiting_buffer_enq: Over flow.\n");
 1344               		.loc 1 306 35 view .LVU324
 1345 007a 8770      		andi r24,7
 1346 007c 9927      		clr r25
 306:./tmk_core/common/action_tapping.c ****         debug("waiting_buffer_enq: Over flow.\n");
 1347               		.loc 1 306 57 view .LVU325
 1348 007e E091 0000 		lds r30,waiting_buffer_tail
 306:./tmk_core/common/action_tapping.c ****         debug("waiting_buffer_enq: Over flow.\n");
 1349               		.loc 1 306 8 view .LVU326
 1350 0082 E817      		cp r30,r24
 1351 0084 1906      		cpc __zero_reg__,r25
 1352 0086 01F4      		brne .L177
 1353               	.LVL78:
 306:./tmk_core/common/action_tapping.c ****         debug("waiting_buffer_enq: Over flow.\n");
 1354               		.loc 1 306 8 view .LVU327
 1355               	.LBE66:
 1356               	.LBE65:
 1357               	.LBB70:
  52:./tmk_core/common/action_tapping.c ****             clear_keyboard();
 1358               		.loc 1 52 50 is_stmt 1 view .LVU328
  53:./tmk_core/common/action_tapping.c ****             waiting_buffer_clear();
 1359               		.loc 1 53 13 view .LVU329
 1360 0088 0E94 0000 		call clear_keyboard
 1361               	.LVL79:
  54:./tmk_core/common/action_tapping.c ****             tapping_key = (keyrecord_t){};
 1362               		.loc 1 54 13 view .LVU330
 1363               	.LBB71:
 1364               	.LBI71:
 322:./tmk_core/common/action_tapping.c **** {
 1365               		.loc 1 322 6 view .LVU331
 1366               	.LBB72:
 324:./tmk_core/common/action_tapping.c ****     waiting_buffer_tail = 0;
 1367               		.loc 1 324 5 view .LVU332
 324:./tmk_core/common/action_tapping.c ****     waiting_buffer_tail = 0;
 1368               		.loc 1 324 25 is_stmt 0 view .LVU333
 1369 008c 1092 0000 		sts waiting_buffer_head,__zero_reg__
 325:./tmk_core/common/action_tapping.c **** }
 1370               		.loc 1 325 5 is_stmt 1 view .LVU334
 325:./tmk_core/common/action_tapping.c **** }
 1371               		.loc 1 325 25 is_stmt 0 view .LVU335
 1372 0090 1092 0000 		sts waiting_buffer_tail,__zero_reg__
 1373               	.LBE72:
 1374               	.LBE71:
  55:./tmk_core/common/action_tapping.c ****         }
 1375               		.loc 1 55 13 is_stmt 1 view .LVU336
  55:./tmk_core/common/action_tapping.c ****         }
 1376               		.loc 1 55 25 is_stmt 0 view .LVU337
 1377 0094 86E0      		ldi r24,lo8(6)
 1378 0096 E0E0      		ldi r30,lo8(tapping_key)
 1379 0098 F0E0      		ldi r31,hi8(tapping_key)
 1380 009a DF01      		movw r26,r30
 1381               		0:
 1382 009c 1D92      		st X+,__zero_reg__
 1383 009e 8A95      		dec r24
 1384 00a0 01F4      		brne 0b
 1385 00a2 00C0      		rjmp .L153
 1386               	.LVL80:
 1387               	.L177:
  55:./tmk_core/common/action_tapping.c ****         }
 1388               		.loc 1 55 25 view .LVU338
 1389               	.LBE70:
 1390               	.LBB73:
 1391               	.LBB69:
 311:./tmk_core/common/action_tapping.c ****     waiting_buffer_head = (waiting_buffer_head + 1) % WAITING_BUFFER_SIZE;
 1392               		.loc 1 311 5 is_stmt 1 view .LVU339
 311:./tmk_core/common/action_tapping.c ****     waiting_buffer_head = (waiting_buffer_head + 1) % WAITING_BUFFER_SIZE;
 1393               		.loc 1 311 41 is_stmt 0 view .LVU340
 1394 00a4 5983      		std Y+1,r21
 1395 00a6 4A83      		std Y+2,r20
 1396 00a8 7D83      		std Y+5,r23
 1397 00aa 6C83      		std Y+4,r22
 1398 00ac 96E0      		ldi r25,lo8(6)
 1399 00ae 929F      		mul r25,r18
 1400 00b0 D001      		movw r26,r0
 1401 00b2 939F      		mul r25,r19
 1402 00b4 B00D      		add r27,r0
 1403 00b6 1124      		clr __zero_reg__
 1404 00b8 A050      		subi r26,lo8(-(waiting_buffer))
 1405 00ba B040      		sbci r27,hi8(-(waiting_buffer))
 1406 00bc FE01      		movw r30,r28
 1407 00be 3196      		adiw r30,1
 1408               		0:
 1409 00c0 0190      		ld r0,Z+
 1410 00c2 0D92      		st X+,r0
 1411 00c4 9A95      		dec r25
 1412 00c6 01F4      		brne 0b
 312:./tmk_core/common/action_tapping.c **** 
 1413               		.loc 1 312 5 is_stmt 1 view .LVU341
 312:./tmk_core/common/action_tapping.c **** 
 1414               		.loc 1 312 25 is_stmt 0 view .LVU342
 1415 00c8 8093 0000 		sts waiting_buffer_head,r24
 314:./tmk_core/common/action_tapping.c ****     return true;
 1416               		.loc 1 314 34 is_stmt 1 view .LVU343
 314:./tmk_core/common/action_tapping.c ****     return true;
 1417               		.loc 1 314 36 view .LVU344
 1418 00cc 0E94 0000 		call debug_waiting_buffer
 1419               	.LVL81:
 315:./tmk_core/common/action_tapping.c **** }
 1420               		.loc 1 315 5 view .LVU345
 315:./tmk_core/common/action_tapping.c **** }
 1421               		.loc 1 315 5 is_stmt 0 view .LVU346
 1422 00d0 00C0      		rjmp .L153
 1423               	.L158:
 315:./tmk_core/common/action_tapping.c **** }
 1424               		.loc 1 315 5 view .LVU347
 1425               	.LBE69:
 1426               	.LBE73:
  64:./tmk_core/common/action_tapping.c ****             debug("processed: waiting_buffer["); debug_dec(waiting_buffer_tail); debug("] = ");
 1427               		.loc 1 64 9 is_stmt 1 view .LVU348
  64:./tmk_core/common/action_tapping.c ****             debug("processed: waiting_buffer["); debug_dec(waiting_buffer_tail); debug("] = ");
 1428               		.loc 1 64 13 is_stmt 0 view .LVU349
 1429 00d2 819F      		mul r24,r17
 1430 00d4 C001      		movw r24,r0
 1431 00d6 1124      		clr __zero_reg__
 1432 00d8 8050      		subi r24,lo8(-(waiting_buffer))
 1433 00da 9040      		sbci r25,hi8(-(waiting_buffer))
 1434 00dc 0E94 0000 		call process_tapping
 1435               	.LVL82:
  64:./tmk_core/common/action_tapping.c ****             debug("processed: waiting_buffer["); debug_dec(waiting_buffer_tail); debug("] = ");
 1436               		.loc 1 64 12 view .LVU350
 1437 00e0 8823      		tst r24
 1438 00e2 01F0      		breq .L151
  65:./tmk_core/common/action_tapping.c ****             debug_record(waiting_buffer[waiting_buffer_tail]); debug("\n\n");
 1439               		.loc 1 65 48 is_stmt 1 view .LVU351
  65:./tmk_core/common/action_tapping.c ****             debug_record(waiting_buffer[waiting_buffer_tail]); debug("\n\n");
 1440               		.loc 1 65 80 view .LVU352
  65:./tmk_core/common/action_tapping.c ****             debug_record(waiting_buffer[waiting_buffer_tail]); debug("\n\n");
 1441               		.loc 1 65 95 view .LVU353
  66:./tmk_core/common/action_tapping.c ****         } else {
 1442               		.loc 1 66 13 view .LVU354
 1443 00e4 E091 0000 		lds r30,waiting_buffer_tail
 1444 00e8 1E9F      		mul r17,r30
 1445 00ea F001      		movw r30,r0
 1446 00ec 1124      		clr __zero_reg__
 1447 00ee E050      		subi r30,lo8(-(waiting_buffer))
 1448 00f0 F040      		sbci r31,hi8(-(waiting_buffer))
 1449 00f2 4081      		ld r20,Z
 1450 00f4 5181      		ldd r21,Z+1
 1451 00f6 6281      		ldd r22,Z+2
 1452 00f8 7381      		ldd r23,Z+3
 1453 00fa 8481      		ldd r24,Z+4
 1454 00fc 9581      		ldd r25,Z+5
 1455 00fe 0E94 0000 		call debug_record
 1456               	.LVL83:
  66:./tmk_core/common/action_tapping.c ****         } else {
 1457               		.loc 1 66 77 view .LVU355
  63:./tmk_core/common/action_tapping.c ****         if (process_tapping(&waiting_buffer[waiting_buffer_tail])) {
 1458               		.loc 1 63 56 view .LVU356
  63:./tmk_core/common/action_tapping.c ****         if (process_tapping(&waiting_buffer[waiting_buffer_tail])) {
 1459               		.loc 1 63 99 is_stmt 0 view .LVU357
 1460 0102 8091 0000 		lds r24,waiting_buffer_tail
 1461 0106 90E0      		ldi r25,0
 1462 0108 0196      		adiw r24,1
  63:./tmk_core/common/action_tapping.c ****         if (process_tapping(&waiting_buffer[waiting_buffer_tail])) {
 1463               		.loc 1 63 104 view .LVU358
 1464 010a 8770      		andi r24,7
 1465 010c 9927      		clr r25
  63:./tmk_core/common/action_tapping.c ****         if (process_tapping(&waiting_buffer[waiting_buffer_tail])) {
 1466               		.loc 1 63 76 view .LVU359
 1467 010e 8093 0000 		sts waiting_buffer_tail,r24
 1468               	.L160:
  63:./tmk_core/common/action_tapping.c ****         if (process_tapping(&waiting_buffer[waiting_buffer_tail])) {
 1469               		.loc 1 63 12 is_stmt 1 discriminator 1 view .LVU360
  63:./tmk_core/common/action_tapping.c ****         if (process_tapping(&waiting_buffer[waiting_buffer_tail])) {
 1470               		.loc 1 63 32 is_stmt 0 discriminator 1 view .LVU361
 1471 0112 8091 0000 		lds r24,waiting_buffer_tail
  63:./tmk_core/common/action_tapping.c ****         if (process_tapping(&waiting_buffer[waiting_buffer_tail])) {
 1472               		.loc 1 63 5 discriminator 1 view .LVU362
 1473 0116 9091 0000 		lds r25,waiting_buffer_head
 1474 011a 8913      		cpse r24,r25
 1475 011c 00C0      		rjmp .L158
 1476               	.L151:
 1477               	/* epilogue start */
  74:./tmk_core/common/action_tapping.c **** 
 1478               		.loc 1 74 1 view .LVU363
 1479 011e 2C96      		adiw r28,12
 1480 0120 0FB6      		in __tmp_reg__,__SREG__
 1481 0122 F894      		cli
 1482 0124 DEBF      		out __SP_H__,r29
 1483 0126 0FBE      		out __SREG__,__tmp_reg__
 1484 0128 CDBF      		out __SP_L__,r28
 1485 012a DF91      		pop r29
 1486 012c CF91      		pop r28
 1487 012e 1F91      		pop r17
 1488 0130 0895      		ret
 1489               	.L175:
  47:./tmk_core/common/action_tapping.c ****         }
 1490               		.loc 1 47 33 is_stmt 1 view .LVU364
  47:./tmk_core/common/action_tapping.c ****         }
 1491               		.loc 1 47 35 view .LVU365
 1492 0132 6985      		ldd r22,Y+9
 1493 0134 7A85      		ldd r23,Y+10
 1494 0136 8B85      		ldd r24,Y+11
 1495 0138 9C85      		ldd r25,Y+12
 1496 013a 0E94 0000 		call debug_record
 1497               	.LVL84:
 1498 013e 00C0      		rjmp .L153
 1499               		.cfi_endproc
 1500               	.LFE4:
 1502               		.section	.bss.waiting_buffer_tail,"aw",@nobits
 1505               	waiting_buffer_tail:
 1506 0000 00        		.zero	1
 1507               		.section	.bss.waiting_buffer_head,"aw",@nobits
 1510               	waiting_buffer_head:
 1511 0000 00        		.zero	1
 1512               		.section	.bss.waiting_buffer,"aw",@nobits
 1515               	waiting_buffer:
 1516 0000 0000 0000 		.zero	48
 1516      0000 0000 
 1516      0000 0000 
 1516      0000 0000 
 1516      0000 0000 
 1517               		.section	.bss.tapping_key,"aw",@nobits
 1520               	tapping_key:
 1521 0000 0000 0000 		.zero	6
 1521      0000 
 1522               		.text
 1523               	.Letext0:
 1524               		.file 3 "/usr/local/Cellar/avr-gcc@9/9.3.0_3/avr/include/stdint.h"
 1525               		.file 4 "./tmk_core/common/keycode.h"
 1526               		.file 5 "./tmk_core/common/action_code.h"
 1527               		.file 6 "./tmk_core/common/action.h"
 1528               		.file 7 "./tmk_core/common/action_layer.h"
 1529               		.file 8 "./tmk_core/common/timer.h"
 1530               		.file 9 "./tmk_core/common/avr/xprintf.h"
 1531               		.file 10 "./tmk_core/common/debug.h"
DEFINED SYMBOLS
                            *ABS*:0000000000000000 action_tapping.c
/var/folders/_p/hcjbsmwn4x14x6mnhxrqw_c80000gn/T//cca6pvd9.s:2      *ABS*:000000000000003e __SP_H__
/var/folders/_p/hcjbsmwn4x14x6mnhxrqw_c80000gn/T//cca6pvd9.s:3      *ABS*:000000000000003d __SP_L__
/var/folders/_p/hcjbsmwn4x14x6mnhxrqw_c80000gn/T//cca6pvd9.s:4      *ABS*:000000000000003f __SREG__
/var/folders/_p/hcjbsmwn4x14x6mnhxrqw_c80000gn/T//cca6pvd9.s:5      *ABS*:0000000000000000 __tmp_reg__
/var/folders/_p/hcjbsmwn4x14x6mnhxrqw_c80000gn/T//cca6pvd9.s:6      *ABS*:0000000000000001 __zero_reg__
/var/folders/_p/hcjbsmwn4x14x6mnhxrqw_c80000gn/T//cca6pvd9.s:12     .text.debug_waiting_buffer:0000000000000000 debug_waiting_buffer
/var/folders/_p/hcjbsmwn4x14x6mnhxrqw_c80000gn/T//cca6pvd9.s:1505   .bss.waiting_buffer_tail:0000000000000000 waiting_buffer_tail
/var/folders/_p/hcjbsmwn4x14x6mnhxrqw_c80000gn/T//cca6pvd9.s:1510   .bss.waiting_buffer_head:0000000000000000 waiting_buffer_head
/var/folders/_p/hcjbsmwn4x14x6mnhxrqw_c80000gn/T//cca6pvd9.s:1515   .bss.waiting_buffer:0000000000000000 waiting_buffer
/var/folders/_p/hcjbsmwn4x14x6mnhxrqw_c80000gn/T//cca6pvd9.s:95     .text.debug_tapping_key:0000000000000000 debug_tapping_key
/var/folders/_p/hcjbsmwn4x14x6mnhxrqw_c80000gn/T//cca6pvd9.s:1520   .bss.tapping_key:0000000000000000 tapping_key
/var/folders/_p/hcjbsmwn4x14x6mnhxrqw_c80000gn/T//cca6pvd9.s:118    .text.waiting_buffer_typed.isra.0:0000000000000000 waiting_buffer_typed.isra.0
/var/folders/_p/hcjbsmwn4x14x6mnhxrqw_c80000gn/T//cca6pvd9.s:194    .text.waiting_buffer_scan_tap:0000000000000000 waiting_buffer_scan_tap
/var/folders/_p/hcjbsmwn4x14x6mnhxrqw_c80000gn/T//cca6pvd9.s:375    .text.process_tapping:0000000000000000 process_tapping
/var/folders/_p/hcjbsmwn4x14x6mnhxrqw_c80000gn/T//cca6pvd9.s:1228   .text.action_tapping_process:0000000000000000 action_tapping_process

UNDEFINED SYMBOLS
debug_record
process_record
layer_switch_get_action
is_tap_key
debug_event
process_record_tap_hint
clear_keyboard
__do_clear_bss
